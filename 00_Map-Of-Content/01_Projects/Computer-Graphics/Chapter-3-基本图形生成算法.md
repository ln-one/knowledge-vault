# 第三章 基本图形生成算法

---

## 概述

本章主要介绍在光栅显示器上生成基本图形（直线、圆弧）的算法，以及线宽、线型处理、区域填充和反走样技术。

**基本概念：**
- **像素（Pixel）**：光栅扫描显示器上的可显示元素
- **光栅（Raster）**：像素排成的矩形阵列
- **扫描转换/光栅化（Rasterization）**：将图形转换为适合光栅显示器显示的形式

**扫描转换包含两个过程：**
1. **确定像素集合**：通过算法确定最佳逼近图形的像素集合
2. **像素着色**：按扫描顺序对像素进行写操作，完成图形显示

**坐标系约定：**
- 坐标原点位于左下角（数学坐标系）
- 像素由其左下角坐标表示
- 整数坐标系，像素间均匀分布

---

## 核心算法公式速查表【必背】

### 直线生成算法

**DDA算法：**
- 当 $|m| \leq 1$ 时：$x_{k+1} = x_k + 1$，$y_{k+1} = y_k + m$
- 当 $|m| > 1$ 时：$y_{k+1} = y_k + 1$，$x_{k+1} = x_k + \frac{1}{m}$

**中点画线算法：**
- 初始：$d_0 = 2a + b$，其中 $a = y_0 - y_1$，$b = x_1 - x_0$
- $d < 0$：选上方像素，$d_{new} = d + 2a + 2b$
- $d \geq 0$：选下方像素，$d_{new} = d + 2a$

**Bresenham画线算法：**

情况1：$|m| \leq 1$（x为主方向，每步x+1）
- 初始：$e_0 = 2\Delta y - \Delta x$
- $e < 0$：y不变，$e_{new} = e + 2\Delta y$
- $e \geq 0$：y+1，$e_{new} = e + 2\Delta y - 2\Delta x$

情况2：$|m| > 1$（y为主方向，每步y+1）
- 初始：$e_0 = 2\Delta x - \Delta y$
- $e < 0$：x不变，$e_{new} = e + 2\Delta x$
- $e \geq 0$：x+1，$e_{new} = e + 2\Delta x - 2\Delta y$

### 圆弧生成算法

**中点画圆算法：**
- 初始：$d_0 = 1 - r$
- $d < 0$：选H（右方），$d_{new} = d + 2x + 3$
- $d \geq 0$：选D（右下），$d_{new} = d + 2(x - y) + 5$

**Bresenham画圆算法：**
- 初始：$p_0 = 3 - 2r$
- $p < 0$：选H（右方），$p_{new} = p + 4x + 6$
- $p \geq 0$：选D（右下），$p_{new} = p + 4(x - y) + 10$

---

## 1. 直线生成算法【重点算法】

> **去年期中考试分值：12分**（2题，每题6分）

### 1.1 数值微分分析法（DDA）【基础算法】

#### 基本原理

DDA算法基于直线的微分方程，通过数值方法逐步计算直线上的点。这是最直观的直线生成方法。

**直线方程：**
设直线通过两点：$(x_0, y_0)$，$(x_1, y_1)$

斜率为：$m = \frac{y_1 - y_0}{x_1 - x_0} = \frac{\Delta y}{\Delta x}$

**核心思想：**
根据斜率大小选择主方向，沿主方向每次前进一个像素，另一方向按斜率增量计算。

#### 递推公式

**当 $|m| \leq 1$ 时（x为主方向）：**
$$x_{k+1} = x_k + 1, \quad y_{k+1} = y_k + m$$

**当 $|m| > 1$ 时（y为主方向）：**
$$y_{k+1} = y_k + 1, \quad x_{k+1} = x_k + \frac{1}{m}$$

选择主方向是为了保证每一步都有像素被绘制，避免出现断点。

#### 算法步骤

1. 计算 $\Delta x = x_1 - x_0$，$\Delta y = y_1 - y_0$
2. 确定步数：$steps = \max(|\Delta x|, |\Delta y|)$
3. 计算增量：$x_{inc} = \frac{\Delta x}{steps}$，$y_{inc} = \frac{\Delta y}{steps}$
4. 从起点开始，逐步计算并绘制像素点（y值取整）

#### 【计算示例】DDA算法

**题目：** 用DDA算法绘制直线 $(2, 2) \to (7, 5)$

**解答步骤：**

**步骤1：计算参数**
- $\Delta x = 7 - 2 = 5$
- $\Delta y = 5 - 2 = 3$
- $m = \frac{3}{5} = 0.6$
- 由于 $|m| = 0.6 \leq 1$，x为主方向

**步骤2：递推计算**

| k | $x_k$ | $y_k$ | $y_k$取整 | 绘制像素 |
|---|-------|-------|-----------|----------|
| 0 | 2 | 2.0 | 2 | (2, 2) |
| 1 | 3 | 2.6 | 3 | (3, 3) |
| 2 | 4 | 3.2 | 3 | (4, 3) |
| 3 | 5 | 3.8 | 4 | (5, 4) |
| 4 | 6 | 4.4 | 4 | (6, 4) |
| 5 | 7 | 5.0 | 5 | (7, 5) |

**绘制像素序列：** $(2,2), (3,3), (4,3), (5,4), (6,4), (7,5)$

#### 优缺点分析

**优点：**
- 算法简单，原理直观
- 适用于所有斜率的直线
- 易于理解和实现

**缺点：**
- 需要浮点运算，效率较低
- 舍入误差可能导致像素不连续
- 不适合硬件实现

---

### 1.2 中点画线算法【重点算法】

#### 基本原理

中点算法通过判断中点位置来决定下一个像素的选择，避免了浮点运算，是一种高效的整数算法。

**直线隐式方程：**
$$F(x,y) = ax + by + c = 0$$

其中：$a = y_0 - y_1$，$b = x_1 - x_0$，$c = x_0y_1 - x_1y_0$

**直线方程的性质：**（对于斜率 $0 < m < 1$ 的直线，$a < 0$，$b > 0$）
- $F(x,y) = 0$：点在直线上
- $F(x,y) < 0$：点在直线下方
- $F(x,y) > 0$：点在直线上方

**判别式：**
$$d = F(x_k+1, y_k+0.5) = a(x_k+1) + b(y_k+0.5) + c$$

中点 $(x_k+1, y_k+0.5)$ 用于判断直线在两个候选像素之间的位置关系。

#### 决策规则

对于斜率 $0 < m < 1$ 的直线（第一象限）：

- 若 $d < 0$：中点在直线下方，直线更靠近上方像素，选择 $P_2(x_k+1, y_k+1)$
- 若 $d \geq 0$：中点在直线上方，直线更靠近下方像素，选择 $P_1(x_k+1, y_k)$

#### 增量计算

为提高效率，采用增量法递推判别式：

**当选择 $P_1$（下方像素）时：**
$$d_{new} = F(x_k+2, y_k+0.5) = d + a$$

**当选择 $P_2$（上方像素）时：**
$$d_{new} = F(x_k+2, y_k+1.5) = d + a + b$$

**初始判别式：**
$$d_0 = F(x_0+1, y_0+0.5) = a + 0.5b$$

为消除小数，将判别式乘以2：
$$d_0 = 2a + b$$

此时增量变为：
- 选择 $P_1$：$d_{new} = d + 2a$
- 选择 $P_2$：$d_{new} = d + 2a + 2b$

#### 【去年真题示例】中点画线法计算题（6分）

**题目：** 设平面上某直线起点的坐标为（5，10），终点为（10，15），若采用中点画线法绘制该直线，在X=8时，对应的Y值为多少？请写出具体的计算方法以及计算过程。

**解答步骤：**

**步骤1：计算参数**（2分）
- $\Delta x = 10 - 5 = 5$
- $\Delta y = 15 - 10 = 5$
- $a = y_0 - y_1 = 10 - 15 = -5$
- $b = x_1 - x_0 = 10 - 5 = 5$
- $d_0 = 2a + b = 2(-5) + 5 = -5$

**步骤2：确定增量**（1分）
- 选择 $P_1$（d≥0）：$d_{new} = d + 2a = d + (-10) = d - 10$
- 选择 $P_2$（d<0）：$d_{new} = d + 2a + 2b = d + (-10) + 10 = d$

**步骤3：递推计算**（2分）

| i | $x_i$ | $y_i$ | d | 决策 | $d_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|---|------|-----------|-----------|-----------|
| 0 | 5 | 10 | -5 | d<0，选P₂ | -5 | 6 | 11 |
| 1 | 6 | 11 | -5 | d<0，选P₂ | -5 | 7 | 12 |
| 2 | 7 | 12 | -5 | d<0，选P₂ | -5 | 8 | 13 |

**答案：Y = 13**（1分）

说明：由于斜率正好等于1，每次都选择对角线方向前进。

#### 【扩展练习题】中点画线法

**题目：** 绘制直线 $(0, 0) \to (5, 3)$，求 $X=3$ 时的 $Y$ 值。

**解答：**

**步骤1：计算参数**
- $a = 0 - 3 = -3$
- $b = 5 - 0 = 5$
- $d_0 = 2(-3) + 5 = -1$

**步骤2：确定增量**
- 选择 $P_1$（d≥0）：$d_{new} = d + 2a = d - 6$
- 选择 $P_2$（d<0）：$d_{new} = d + 2a + 2b = d - 6 + 10 = d + 4$

**步骤3：递推计算**

| i | $x_i$ | $y_i$ | d | 决策 | $d_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|---|------|-----------|-----------|-----------|
| 0 | 0 | 0 | -1 | d<0，选P₂ | -1+4=3 | 1 | 1 |
| 1 | 1 | 1 | 3 | d≥0，选P₁ | 3-6=-3 | 2 | 1 |
| 2 | 2 | 1 | -3 | d<0，选P₂ | -3+4=1 | 3 | 2 |

**答案：Y = 2**

#### 优缺点分析

**优点：**
- 只有整数运算，效率高
- 精度好，无累积误差
- 适合硬件实现

**缺点：**
- 算法相对复杂
- 需要针对不同象限进行处理

---

### 1.3 Bresenham画线算法【重点算法】

#### 基本思想

Bresenham算法通过比较误差项来决定像素选择，是最广泛使用的直线生成算法。其核心思想是用误差项e表示当前像素点到理想直线的偏差，通过符号判断选择最接近的像素。

**误差项定义：**
对于斜率 $0 < m < 1$ 的直线，定义误差项：
$$e = 2\Delta y - \Delta x$$

#### 决策规则（$|m| \leq 1$，x为主方向）

- 若 $e < 0$：选择右方像素（y不变），$e_{new} = e + 2\Delta y$
- 若 $e \geq 0$：选择右上方像素（y+1），$e_{new} = e + 2\Delta y - 2\Delta x$

#### 决策规则（$|m| > 1$，y为主方向）

- 若 $e < 0$：选择上方像素（x不变），$e_{new} = e + 2\Delta x$
- 若 $e \geq 0$：选择右上方像素（x+1），$e_{new} = e + 2\Delta x - 2\Delta y$

#### 通用算法步骤

1. **确定主方向**：$|m| \leq 1$ 时x为主方向，$|m| > 1$ 时y为主方向
2. **确定步进方向**：根据直线所在象限确定增减方向
3. **初始化误差项**：
   - $|m| \leq 1$ 时：$e_0 = 2\Delta y - \Delta x$
   - $|m| > 1$ 时：$e_0 = 2\Delta x - \Delta y$
4. **循环绘制**：根据误差项符号选择像素并更新误差项

#### 【去年真题示例】Bresenham画线法计算题（6分）

**题目：** 设平面上某直线起点的坐标为（5，10），终点为（10，15），若采用Bresenham法绘制该直线，在Y=12时，对应的X值为多少？请写出具体的计算方法以及计算过程。

**解答步骤：**

**步骤1：计算参数**（2分）
- $\Delta x = 10 - 5 = 5$
- $\Delta y = 15 - 10 = 5$
- $|m| = \frac{5}{5} = 1$，x为主方向
- $e_0 = 2\Delta y - \Delta x = 2(5) - 5 = 5$

**步骤2：确定增量**（1分）
- 当 $e \geq 0$ 时：$e_{new} = e + 2\Delta y - 2\Delta x = e + 10 - 10 = e$
- 当 $e < 0$ 时：$e_{new} = e + 2\Delta y = e + 10$

**步骤3：递推计算**（2分）

| i | $x_i$ | $y_i$ | e | 决策 | $e_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|---|------|-----------|-----------|-----------|
| 0 | 5 | 10 | 5 | e≥0，y+1 | 5 | 6 | 11 |
| 1 | 6 | 11 | 5 | e≥0，y+1 | 5 | 7 | 12 |

**答案：X = 7**（1分）

说明：当 $\Delta x = \Delta y$ 时，斜率=1，每次都沿对角线前进。

#### 【去年期末真题示例】Bresenham画线法（6分）

**题目：** 设平面上某线段起点的坐标为（10，10），终点的坐标为（15，20），如果采用Bresenham法绘制该线段，请写出X=13时，对应的Y值为多少？写出算法的求解过程。

**解答步骤：**

**步骤1：计算参数**（2分）
- $\Delta x = 15 - 10 = 5$
- $\Delta y = 20 - 10 = 10$
- $|m| = \frac{10}{5} = 2 > 1$，**y为主方向**
- $e_0 = 2\Delta x - \Delta y = 2(5) - 10 = 0$

**步骤2：确定增量**（1分）

当y为主方向时，每一步y增加1：
- 若 $e < 0$：x不变，$e_{new} = e + 2\Delta x = e + 10$
- 若 $e \geq 0$：x增加1，$e_{new} = e + 2\Delta x - 2\Delta y = e + 10 - 20 = e - 10$

**步骤3：递推计算**（2分）

| i | $x_i$ | $y_i$ | e | 决策 | $e_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|---|------|-----------|-----------|-----------|
| 0 | 10 | 10 | 0 | e≥0，x+1 | -10 | 11 | 11 |
| 1 | 11 | 11 | -10 | e<0，x不变 | 0 | 11 | 12 |
| 2 | 11 | 12 | 0 | e≥0，x+1 | -10 | 12 | 13 |
| 3 | 12 | 13 | -10 | e<0，x不变 | 0 | 12 | 14 |
| 4 | 12 | 14 | 0 | e≥0，x+1 | -10 | 13 | 15 |
| 5 | 13 | 15 | -10 | e<0，x不变 | 0 | 13 | 16 |

从表格可以看出，当 $X=13$ 时，对应的Y值为15或16。

**答案：Y = 16**（1分）

（取最接近理论值 $y = 10 + 2(13-10) = 16$ 的点）

#### 【扩展练习题】Bresenham画线法

**题目：** 绘制直线 $(2, 3) \to (8, 7)$，求 $Y=5$ 时的 $X$ 值。

**解答：**

**步骤1：计算参数**
- $\Delta x = 6$，$\Delta y = 4$
- $|m| = \frac{4}{6} = 0.67 < 1$，x为主方向
- $e_0 = 2(4) - 6 = 2$

**步骤2：确定增量**
- 当 $e \geq 0$ 时：$e_{new} = e + 2\Delta y - 2\Delta x = e + 8 - 12 = e - 4$
- 当 $e < 0$ 时：$e_{new} = e + 2\Delta y = e + 8$

**步骤3：递推计算**

| i | $x_i$ | $y_i$ | e | 决策 | $e_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|---|------|-----------|-----------|-----------|
| 0 | 2 | 3 | 2 | e≥0，y+1 | -2 | 3 | 4 |
| 1 | 3 | 4 | -2 | e<0，y不变 | 6 | 4 | 4 |
| 2 | 4 | 4 | 6 | e≥0，y+1 | 2 | 5 | 5 |

**答案：X = 5**

#### 优缺点分析

**优点：**
- 整数运算，速度快
- 精度高，无累积误差
- 乘2运算可用移位实现，适于硬件
- 使用最广泛

**缺点：**
- 需要针对不同象限进行处理
- 算法逻辑相对复杂

---

## 2. 圆和圆弧的扫描转换【重点算法】

> **去年期中考试分值：12分**（2题，每题6分）

### 2.1 圆的对称性

圆具有八对称性，只需计算1/8圆弧（第一八分圆），其余部分通过对称变换得到。这是圆弧生成算法的核心优化思想。

**八个对称点：**
对于圆心在原点、半径为r的圆上的点 $(x, y)$，对应的八个对称点为：
- $(x, y)$，$(-x, y)$，$(x, -y)$，$(-x, -y)$
- $(y, x)$，$(-y, x)$，$(y, -x)$，$(-y, -x)$

**第一八分圆：**
从点 $(0, r)$ 开始，沿顺时针方向到点 $(r/\sqrt{2}, r/\sqrt{2})$，即 $0 \leq x \leq y$ 的区域。

**对称性的应用：**
```
void CirclePoints(int x, int y, int xc, int yc) {
    // 绘制八个对称点
    putpixel(xc+x, yc+y);  putpixel(xc-x, yc+y);
    putpixel(xc+x, yc-y);  putpixel(xc-x, yc-y);
    putpixel(xc+y, yc+x);  putpixel(xc-y, yc+x);
    putpixel(xc+y, yc-x);  putpixel(xc-y, yc-x);
}
```

---

### 2.2 中点画圆法【重点算法】

#### 基本原理

类似中点画线法，通过判断中点位置来选择下一个像素。在第一八分圆中，每次x增加1，判断y是否减少1。

**圆的隐式方程：**
$$F(x,y) = x^2 + y^2 - r^2 = 0$$

**方程性质：**
- $F(x,y) = 0$：点在圆上
- $F(x,y) < 0$：点在圆内
- $F(x,y) > 0$：点在圆外

**判别式：**
$$d_n = F(x_n+1, y_n-0.5) = (x_n+1)^2 + (y_n-0.5)^2 - r^2$$

中点 $(x_n+1, y_n-0.5)$ 用于判断圆弧在两个候选像素之间的位置。

#### 决策规则

在第一八分圆中，候选像素为：
- H（右方像素）：$(x_n+1, y_n)$
- D（右下方像素）：$(x_n+1, y_n-1)$

**决策规则：**
- 若 $d_n < 0$：中点在圆内，圆弧更靠近H，选择 $H(x_n+1, y_n)$
- 若 $d_n \geq 0$：中点在圆外，圆弧更靠近D，选择 $D(x_n+1, y_n-1)$

#### 增量计算

**选择H时（y不变）：**
$$d_{n+1} = F(x_n+2, y_n-0.5) = d_n + 2x_n + 3$$

**选择D时（y减1）：**
$$d_{n+1} = F(x_n+2, y_n-1.5) = d_n + 2(x_n - y_n) + 5$$

**初始判别式：**
起点为 $(0, r)$，初始判别式为：
$$d_0 = F(1, r-0.5) = 1 + (r-0.5)^2 - r^2 = 1.25 - r$$

为避免小数，可用 $d_0 = 1 - r$（当r为整数时，1.25-r与1-r的符号相同）

#### 算法步骤

1. 输入圆心 $(x_c, y_c)$ 和半径 $r$
2. 初始点：$(x_0, y_0) = (0, r)$
3. 初始判别式：$d_0 = 1 - r$
4. 当 $x \leq y$ 时，循环：
   - 绘制八个对称点
   - 若 $d < 0$：选择H，$d = d + 2x + 3$，$x = x + 1$
   - 若 $d \geq 0$：选择D，$d = d + 2(x-y) + 5$，$x = x + 1$，$y = y - 1$
5. 将所有点平移到实际圆心位置

#### 【去年真题示例】中点画圆法计算题（6分）

**题目：** 设平面上某圆的圆心坐标为（5，5），半径为10，若采用中点绘制法绘制该圆，在X=15时，对应的Y值是多少？请写出具体的计算方法以及计算过程。

**解答步骤：**

**步骤1：初始化**（1分）
- 初始点：$(x_0, y_0) = (0, 10)$
- 初始判别式：$d_0 = 1 - 10 = -9$

**步骤2：确定增量**（1分）
- 选择H（d<0）：$d_{new} = d + 2x + 3$
- 选择D（d≥0）：$d_{new} = d + 2(x - y) + 5$

**步骤3：递推计算第一八分圆**（3分）

| i | $x_i$ | $y_i$ | $d_i$ | 决策 | $d_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|-------|------|-----------|-----------|-----------|
| 0 | 0 | 10 | -9 | d<0，选H | -9+0+3=-6 | 1 | 10 |
| 1 | 1 | 10 | -6 | d<0，选H | -6+2+3=-1 | 2 | 10 |
| 2 | 2 | 10 | -1 | d<0，选H | -1+4+3=6 | 3 | 10 |
| 3 | 3 | 10 | 6 | d≥0，选D | 6+2(3-10)+5=-3 | 4 | 9 |
| 4 | 4 | 9 | -3 | d<0，选H | -3+8+3=8 | 5 | 9 |
| 5 | 5 | 9 | 8 | d≥0，选D | 8+2(5-9)+5=5 | 6 | 8 |
| 6 | 6 | 8 | 5 | d≥0，选D | 5+2(6-8)+5=6 | 7 | 7 |

当 $x=7, y=7$ 时，$x \leq y$ 不再满足，停止。

**步骤4：利用对称性和平移**（1分）

题目求：圆心 $(5,5)$，半径 $10$，求 $X=15$ 时的 $Y$ 值

相对圆心的坐标：$x = 15 - 5 = 10$

从第一八分圆的计算中，当相对坐标 $x=10$ 时，需要利用对称性。
查看表格，当 $y=10$ 时，$x$ 的范围是 $0 \leq x \leq 3$。
利用对称性 $(y, x) \to (10, 0), (10, 1), (10, 2), (10, 3)$

所以相对坐标 $(10, 0)$ 对应实际坐标 $(15, 5)$。

**答案：Y = 5**

#### 【扩展练习题】中点画圆法

**题目：** 圆心在原点，半径为5，求 $X=3$ 时的 $Y$ 值。

**解答：**

**步骤1：初始化**
- 初始点：$(0, 5)$
- $d_0 = 1 - 5 = -4$

**步骤2：递推计算**

| i | $x_i$ | $y_i$ | $d_i$ | 决策 | $d_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|-------|------|-----------|-----------|-----------|
| 0 | 0 | 5 | -4 | d<0，选H | -4+0+3=-1 | 1 | 5 |
| 1 | 1 | 5 | -1 | d<0，选H | -1+2+3=4 | 2 | 5 |
| 2 | 2 | 5 | 4 | d≥0，选D | 4+2(2-5)+5=3 | 3 | 4 |

**答案：Y = 4**

---

### 2.3 Bresenham画圆算法【重点算法】

#### 基本思想

Bresenham画圆算法通过比较像素与圆的距离平方来选择最接近的像素，避免开方运算。

**三个候选像素：**
- H：水平右方 $(x_i+1, y_i)$
- V：垂直下方 $(x_i, y_i-1)$
- D：对角右下 $(x_i+1, y_i-1)$

#### 决策参数

**判别式：**
$$p = 3 - 2r$$

#### 决策规则

- 若 $p < 0$：选择右方像素 $H(x+1, y)$，$p_{new} = p + 4x + 6$
- 若 $p \geq 0$：选择右下方像素 $D(x+1, y-1)$，$p_{new} = p + 4(x - y) + 10$

#### 【去年真题示例】Bresenham画圆法计算题（6分）

**题目：** 设平面上某圆的圆心坐标为（5，5），半径为10，若采用Bresenham法，在X=0时，对应的Y值是多少？

**解答步骤：**

**步骤1：初始化**（1分）
- 初始点：$(x_0, y_0) = (0, 10)$
- 初始判别式：$p_0 = 3 - 2r = 3 - 2(10) = -17$

**步骤2：确定增量**（1分）
- 若 $p < 0$：选择H，$p_{new} = p + 4x + 6$
- 若 $p \geq 0$：选择D，$p_{new} = p + 4(x - y) + 10$

**步骤3：递推计算第一八分圆**（3分）

| i | $x_i$ | $y_i$ | $p_i$ | 决策 | $p_{new}$ | $x_{i+1}$ | $y_{i+1}$ |
|---|-------|-------|-------|------|-----------|-----------|-----------|
| 0 | 0 | 10 | -17 | p<0，选H | -17+0+6=-11 | 1 | 10 |
| 1 | 1 | 10 | -11 | p<0，选H | -11+4+6=-1 | 2 | 10 |
| 2 | 2 | 10 | -1 | p<0，选H | -1+8+6=13 | 3 | 10 |
| 3 | 3 | 10 | 13 | p≥0，选D | 13+4(3-10)+10=-5 | 4 | 9 |
| 4 | 4 | 9 | -5 | p<0，选H | -5+16+6=17 | 5 | 9 |
| 5 | 5 | 9 | 17 | p≥0，选D | 17+4(5-9)+10=11 | 6 | 8 |
| 6 | 6 | 8 | 11 | p≥0，选D | 11+4(6-8)+10=13 | 7 | 7 |

**步骤4：利用对称性求解**（1分）

题目求：圆心 $(5,5)$，半径 $10$，求 $X=0$ 时的 $Y$ 值

相对圆心的坐标：$x = 0 - 5 = -5$

从第一八分圆的计算中，当相对坐标 $x=5$ 时，$y=9$（第4步结束后）。

利用圆的八对称性：
- 相对坐标 $(5, 9)$ 对称到 $(-5, 9)$（关于y轴对称）
- 实际坐标：$(5, 5) + (-5, 9) = (0, 14)$

同理，利用关于x轴的对称性：
- 相对坐标 $(-5, 9)$ 对称到 $(-5, -9)$
- 实际坐标：$(5, 5) + (-5, -9) = (0, -4)$

**答案：Y = 14 或 Y = -4**

#### 中点画圆法与Bresenham画圆法的比较

| 特性 | 中点画圆法 | Bresenham画圆法 |
|------|-----------|-----------------|
| 初始判别式 | $d_0 = 1 - r$ | $p_0 = 3 - 2r$ |
| d<0时增量 | $2x + 3$ | $4x + 6$ |
| d≥0时增量 | $2(x-y) + 5$ | $4(x-y) + 10$ |
| 精度 | 较高 | 更高 |
| 复杂度 | 较简单 | 稍复杂 |

---

### 2.4 圆弧生成

#### 圆弧的处理方法

圆弧生成需要处理起始角度和终止角度：

1. **角度范围确定**：给定起始角 $\theta_1$ 和终止角 $\theta_2$
2. **八分圆判断**：确定圆弧跨越哪些八分圆
3. **分段绘制**：对每个八分圆分别处理
4. **边界处理**：正确处理起始点和终止点

#### 圆弧绘制的关键点

- 确定圆弧的起点和终点坐标
- 判断圆弧经过的八分圆区域
- 在每个八分圆内使用中点或Bresenham算法
- 注意绘制方向（顺时针或逆时针）

---

## 3. 区域填充算法【重点内容】

### 3.1 问题定义

**主要任务：**
确定哪些像素位于多边形区域内部，并对这些像素进行填充。

**应用场景：**
- 多边形填充
- 图案填充
- 曲线围成区域的填充（用多边形逼近）

### 3.2 点在多边形内的判定

#### 方法一：夹角和法

**原理：**
计算从测试点到多边形各顶点的矢量夹角之和。

**判定规则：**
- 夹角和为0°：点在多边形外
- 夹角和为360°：点在多边形内

**夹角计算：**
- 大小：利用余弦定理
- 方向：通过叉积判断

**缺点：**
- 计算量大，涉及三角函数
- 效率低，不适合实时应用

#### 方法二：射线法（推荐）

**原理：**
从测试点向任意方向发射射线，统计与多边形边界的交点数。

**判定规则：**
- 交点数为偶数（包括0）：点在多边形外
- 交点数为奇数：点在多边形内

**优点：**
- 算法简单，效率高
- 只需要基本的几何运算
- 适用于任意复杂多边形

**特殊情况处理：**
- 射线经过顶点时：检查与该顶点相邻的两条边的另外两个端点
  - 如果都在射线同一侧：计0次
  - 如果在射线两侧：计1次
- 射线与边重合：选择其他方向的射线

#### 【去年真题示例】点在多边形内判定（6分）

**题目：** 已知某多边形ABCDEFG，顶点的坐标依次为：（1，3）（3，3）（5，5）（7，2）（8，2）（6，-1）(2,-2)。请判断点（0，2）是否在该多边形内？请写出判断结果及计算过程。

**解答步骤：**

**步骤1：** 设count=0表示交点的个数（1分）

**步骤2：** 从点$(0,2)$出发，向右发出一条射线，射线方程为 $y=2$，$x \geq 0$（1分）

**步骤3：** 计算该射线与各边的交点（3分）

采用端点处理规则：只统计满足 $(y_i > 2) \neq (y_j \leq 2)$ 的边

1. **与AB边**（A(1,3)→B(3,3)）：
   - 两端 $y=3, 3$，均 $>2$，不计交点

2. **与BC边**（B(3,3)→C(5,5)）：
   - 两端 $y=3, 5$，均 $>2$，不计交点

3. **与CD边**（C(5,5)→D(7,2)）：
   - 端点 $y=5$ 和 $y=2$，满足 $(5>2) \neq (2\leq 2)$
   - 计算交点横坐标：$x = 5 + \frac{(2-5)(7-5)}{2-5} = 5 + \frac{(-3) \times 2}{-3} = 7$
   - $x=7 > 0$，计数，count = 1

4. **与DE边**（D(7,2)→E(8,2)）：
   - 两端 $y=2, 2$，不满足条件，不计交点

5. **与EF边**（E(8,2)→F(6,-1)）：
   - 端点 $y=2$ 和 $y=-1$，不满足 $(y_i>2) \neq (y_j\leq 2)$，不计交点

6. **与FG边**（F(6,-1)→G(2,-2)）：
   - 两端 $y=-1, -2$，均 $<2$，不计交点

7. **与GA边**（G(2,-2)→A(1,3)）：
   - 端点 $y=-2$ 和 $y=3$，满足 $(-2\leq 2) \neq (3>2)$
   - 计算交点横坐标：$x = 2 + \frac{(2-(-2))(1-2)}{3-(-2)} = 2 + \frac{4 \times (-1)}{5} = 1.2$
   - $x=1.2 > 0$，计数，count = 2

**步骤4：判断结果**（1分）
- count = 2（偶数）
- 根据射线法：交点数为偶数，点在多边形外

**答案：否（点在多边形外）**

---

### 3.3 扫描线填充算法

#### 基本思想

利用扫描线的连贯性，按扫描线顺序处理填充。每条扫描线与多边形的交点将扫描线分成若干区间，交替填充。

**算法优势：**
- 利用空间连贯性
- 每个像素只访问一次
- 效率高，适合大面积填充

#### 核心问题

**1. 交点计算与排序**
- 计算扫描线与多边形边的交点
- 按x坐标对交点排序
- 交点配对填充

**2. 顶点交点的计数问题**

当扫描线经过多边形顶点时，需要正确计数：
- **局部最高点和最低点**：计偶数次（0次或2次）
- **其他顶点**：计1次

**判定方法：**
检查与该顶点相邻的两条边的另外两个端点：
- 如果都在扫描线同一侧：计0次
- 如果在扫描线两侧：计1次

**3. 填充扩大化问题**

**问题：** 直接使用交点坐标可能导致填充区域扩大。

**解决方案：**
- 使用中心扫描线（$y + 0.5$）
- 检查像素中心是否在填充区间内
- 条件：$x_l \leq x + 0.5 \leq x_r$

#### 有序边表算法

**数据结构：**

**活性边表(AET)节点：**
- x：当前扫描线与边的交点
- Δx：x的增量（$1/k$，k为斜率）
- $y_{max}$：边的最高扫描线号

**新边表(NET)节点：**
- $x_0$：边与扫描线的初始交点
- Δx：x的增量
- $y_{max}$：边的最高扫描线号

**算法步骤：**
1. 建立新边表NET
2. 初始化活性边表AET
3. 对每条扫描线：
   - 从NET中加入新的活性边
   - 删除 $y_{max}$ 小于当前扫描线的边
   - 更新活性边的x坐标
   - 按x坐标排序
   - 配对填充

**优点：**
- 每个像素只访问一次
- 与设备无关
- 算法效率高

**缺点：**
- 数据结构复杂
- 表的维护开销大
- 只适合软件实现

---

### 3.4 边填充算法

#### 基本思想

利用异或操作的特性进行填充。

**异或操作特点：**
- 第一次异或：像素置为前景色
- 第二次异或：像素恢复为背景色

#### 算法步骤

1. 对每条与多边形相交的扫描线
2. 计算所有交点
3. 对交点右方的所有像素进行异或操作

#### 优缺点

**优点：**
- 无需复杂链表结构
- 可按任意顺序处理边
- 适合帧缓存显示器

**缺点：**
- 每个像素可能被多次访问
- 输入/输出量大
- 不能与扫描同步

#### 改进：栅栏填充算法

引入栅栏线，只对交点与栅栏线之间的像素进行异或操作，减少重复访问。

---

### 3.5 种子填充算法

#### 基本思想

从区域内部一个已知点（种子点）出发，逐步扩展到整个区域。

**适用场景：**
- 区域边界已知
- 有内部种子点
- 交互式填充

#### 区域连通性

**4连通区域：**
像素与上下左右四个相邻像素连通。

**8连通区域：**
像素与周围八个相邻像素连通。

连通性的选择影响填充结果，需要与边界定义保持一致。

#### 简单种子填充算法（递归实现）

**4连通边界填充算法：**
```c
void BoundaryFill4(int x, int y, int fill, int boundary) {
    int current = getpixel(x, y);
    if ((current != boundary) && (current != fill)) {
        putpixel(x, y, fill);
        BoundaryFill4(x+1, y, fill, boundary);
        BoundaryFill4(x-1, y, fill, boundary);
        BoundaryFill4(x, y+1, fill, boundary);
        BoundaryFill4(x, y-1, fill, boundary);
    }
}
```

**泛填充算法（油漆桶填充）：**
```c
void FloodFill4(int x, int y, int fill, int oldColor) {
    int current = getpixel(x, y);
    if (current == oldColor) {
        putpixel(x, y, fill);
        FloodFill4(x+1, y, fill, oldColor);
        FloodFill4(x-1, y, fill, oldColor);
        FloodFill4(x, y+1, fill, oldColor);
        FloodFill4(x, y-1, fill, oldColor);
    }
}
```

**缺点：**
- 递归深度可能很大，导致栈溢出
- 效率较低
- 可能重复访问像素

#### 扫描线种子填充算法

**改进思想：**
利用扫描线连贯性，每次填充一行像素，减少栈操作。

**算法步骤：**
1. 种子像素入栈
2. 当栈非空时：
   - 栈顶像素出栈
   - 沿扫描线左右填充至边界
   - 记录填充区间 $[x_l, x_r]$
   - 检查上下相邻扫描线
   - 将新的种子区间入栈

**优点：**
- 减少栈操作次数
- 提高填充效率
- 减少重复访问

---

## 4. 线宽与线型的处理

### 4.1 线宽处理方法

#### 方法一：像素复制法（刷子绘制法）

**原理：**
在垂直于直线方向复制像素来增加线宽。

**实现方式：**
- 水平线：在y方向复制像素
- 垂直线：在x方向复制像素
- 斜线：根据斜率选择复制方向

**优点：**
- 效率高，实现简单

**缺点：**
- 线宽与斜率相关，不均匀
- 折线处有缺口
- 对称性问题（奇偶像素效果不同）

#### 方法二：方形刷子法

**原理：**
用方形刷子沿直线移动，覆盖区域形成粗线。

**特点：**
- 线宽仍与斜率相关
- 质量比像素复制法好
- 实现相对简单

#### 方法三：实区域填充法

**原理：**
用等距线围成的实区域表示粗线。

**实现步骤：**
1. 计算直线的法向量
2. 沿法向量方向偏移得到两条平行线
3. 将两条平行线和端点连接形成封闭区域
4. 使用区域填充算法填充

**优点：**
- 线宽均匀
- 端点处理规范
- 生成质量高

**缺点：**
- 计算复杂
- 效率较低

### 4.2 线型处理

#### 位屏蔽器方法

**原理：**
使用位模式控制像素的绘制，实现虚线、点线等效果。

**位屏蔽器示例：**
```
实线：  1111111111111111
虚线：  1111000011110000
点线：  1010101010101010
点划线：1111111100100100
```

**实现方法：**
1. 定义线型的位模式
2. 在绘制每个像素时，检查对应位
3. 位为1则绘制，位为0则跳过

**问题：**
- 线型长度与直线斜率相关
- 斜线的笔画比水平/垂直线长
- 不符合工程制图标准

**解决方案：**
在工程图中，将笔画作为独立的图形元素进行扫描转换，按实际长度控制线型。

---

## 5. 图形反走样技术

### 5.1 走样现象

**走样的表现：**
1. **阶梯状边界**：直线和曲线的锯齿效应
2. **图形细节失真**：小图形变形或面积改变
3. **狭小图形遗失**：细线在动画中时隐时现，产生闪烁

**走样的根本原因：**
用离散的像素表示连续的图形，采样频率不足导致的失真。

走样是数字图形处理的固有问题，完全消除是不可能的，只能通过各种技术减轻。

### 5.2 反走样技术

#### 方法一：提高硬件分辨率

**优点：**
- 效果最直接
- 无需算法改进

**缺点：**
- 成本高昂
- 分辨率提高一倍，帧缓存容量增加4倍
- 带宽和处理时间成倍增加

#### 方法二：像素细分技术（后置滤波）

**原理：**
- 高分辨率计算，低分辨率显示
- 将每个像素细分为子像素
- 计算子像素的覆盖情况
- 按覆盖率确定像素灰度

**实现方法：**

**算术平均：**
简单平均子像素值
$$I = \frac{1}{n}\sum_{i=1}^{n}I_i$$

**加权平均：**
根据位置给予不同权重
$$I = \sum_{i=1}^{n}w_i \cdot I_i$$

常用权重分布（3×3子像素）：
```
1  2  1
2  4  2  / 16
1  2  1
```

**优点：**
- 软件实现，成本低
- 可以减轻走样现象

**缺点：**
- 计算量增加
- 只能减轻，不能完全消除

#### 方法三：区域采样技术（前置滤波）

**原理：**
- 将抽象的几何图形看作有一定宽度的区域
- 计算图形与像素的相交面积
- 根据相交面积确定像素亮度

**面积-亮度映射：**
以8级灰度为例：
- $0 \leq$ 面积 $\leq 1/8$：最暗（灰度级0）
- $7/8 \leq$ 面积 $\leq 1$：最亮（灰度级7）
- 中间按比例分配灰度级

**直线的面积计算：**
设直线宽度为1个像素，与像素的相交面积可通过几何计算得到。

**优点：**
- 理论基础扎实
- 效果较好
- 适合矢量图形

**缺点：**
- 面积计算复杂
- 实现难度大

#### Bresenham反走样技术

**原理：**
在Bresenham算法基础上，根据像素到直线的距离调整像素强度。

**实现方法：**
1. 计算像素中心到理想直线的距离
2. 根据距离计算权重
3. 同时绘制直线两侧的像素，按权重分配亮度

**距离计算：**
$$d = \frac{|ax + by + c|}{\sqrt{a^2 + b^2}}$$

**权重分配：**
- 距离越近，亮度越高
- 距离越远，亮度越低
- 两侧像素亮度之和为常数

---

## 6. 矢量运算【重点内容】

> **去年期中考试分值：6分**

### 6.1 矢量夹角的余弦值

**公式：**
$$\cos\theta = \frac{\vec{u} \cdot \vec{v}}{|\vec{u}| \cdot |\vec{v}|}$$

其中：
- $\vec{u} \cdot \vec{v} = u_x v_x + u_y v_y + u_z v_z$（点积/内积）
- $|\vec{u}| = \sqrt{u_x^2 + u_y^2 + u_z^2}$（模长）

### 6.2 矢量叉积

**公式：**
$$\vec{u} \times \vec{v} = \begin{vmatrix} \vec{i} & \vec{j} & \vec{k} \\ u_x & u_y & u_z \\ v_x & v_y & v_z \end{vmatrix}$$

展开为：
$$\vec{u} \times \vec{v} = (u_y v_z - u_z v_y)\vec{i} - (u_x v_z - u_z v_x)\vec{j} + (u_x v_y - u_y v_x)\vec{k}$$

**叉积的几何意义：**
- 结果向量垂直于原两个向量构成的平面
- 模长等于两向量构成的平行四边形面积
- 方向由右手定则确定

### 6.3 【去年真题示例】矢量运算计算题（6分）

**题目：** 设矢量u=(1,2,3)，v=(-1,-3,1)，请计算矢量u和矢量v之间的夹角的余弦函数值以及u×v的结果。

**解答步骤：**

**1. 计算夹角余弦值：**（3分）

**步骤1：计算点积**
$$\vec{u} \cdot \vec{v} = 1 \times (-1) + 2 \times (-3) + 3 \times 1 = -1 - 6 + 3 = -4$$

**步骤2：计算模长**
$$|\vec{u}| = \sqrt{1^2 + 2^2 + 3^2} = \sqrt{1 + 4 + 9} = \sqrt{14}$$
$$|\vec{v}| = \sqrt{(-1)^2 + (-3)^2 + 1^2} = \sqrt{1 + 9 + 1} = \sqrt{11}$$

**步骤3：计算余弦值**
$$\cos\theta = \frac{-4}{\sqrt{14} \times \sqrt{11}} = \frac{-4}{\sqrt{154}} \approx -0.322$$

**2. 计算叉积：**（3分）

$$\vec{u} \times \vec{v} = \begin{vmatrix} \vec{i} & \vec{j} & \vec{k} \\ 1 & 2 & 3 \\ -1 & -3 & 1 \end{vmatrix}$$

$$= (2 \times 1 - 3 \times (-3))\vec{i} - (1 \times 1 - 3 \times (-1))\vec{j} + (1 \times (-3) - 2 \times (-1))\vec{k}$$

$$= (2 + 9)\vec{i} - (1 + 3)\vec{j} + (-3 + 2)\vec{k}$$

$$= 11\vec{i} - 4\vec{j} - 1\vec{k}$$

**答案：**
- 余弦值：$\frac{-4}{\sqrt{154}}$ 或约 $-0.322$
- 叉积：$(11, -4, -1)$

### 6.4 【扩展练习题】矢量运算

**题目：** 设矢量 $\vec{a}=(2,1,0)$，$\vec{b}=(1,3,2)$，计算夹角余弦值和叉积。

**解答：**

**1. 夹角余弦值：**
- $\vec{a} \cdot \vec{b} = 2(1) + 1(3) + 0(2) = 2 + 3 + 0 = 5$
- $|\vec{a}| = \sqrt{4+1+0} = \sqrt{5}$
- $|\vec{b}| = \sqrt{1+9+4} = \sqrt{14}$
- $\cos\theta = \frac{5}{\sqrt{5} \times \sqrt{14}} = \frac{5}{\sqrt{70}}$

**2. 叉积：**
$$\vec{a} \times \vec{b} = \begin{vmatrix} \vec{i} & \vec{j} & \vec{k} \\ 2 & 1 & 0 \\ 1 & 3 & 2 \end{vmatrix}$$

$$= (1 \times 2 - 0 \times 3)\vec{i} - (2 \times 2 - 0 \times 1)\vec{j} + (2 \times 3 - 1 \times 1)\vec{k}$$

$$= 2\vec{i} - 4\vec{j} + 5\vec{k}$$

**答案：**
- 余弦值：$\frac{5}{\sqrt{70}}$
- 叉积：$(2, -4, 5)$

---

## 考试重点总结

### 必考知识点

**计算题重点（30分）：**

1. **直线生成算法**（12分）
   - 中点画线法：掌握参数计算、递推过程
   - Bresenham画线法：区分x主方向和y主方向

2. **圆弧生成算法**（12分）
   - 中点画圆法：掌握八对称性、递推计算
   - Bresenham画圆法：掌握判别式和增量公式

3. **矢量运算**（6分）
   - 点积计算夹角余弦
   - 叉积计算

4. **点在多边形内判定**（6分）
   - 射线法
   - 顶点处理规则

### 公式速记

| 算法 | 初始值 | d<0时 | d≥0时 |
|------|--------|-------|-------|
| 中点画线 | $d_0=2a+b$ | $d+2a+2b$，选P₂ | $d+2a$，选P₁ |
| Bresenham画线(x主) | $e_0=2Δy-Δx$ | $e+2Δy$，y不变 | $e+2Δy-2Δx$，y+1 |
| 中点画圆 | $d_0=1-r$ | $d+2x+3$，选H | $d+2(x-y)+5$，选D |
| Bresenham画圆 | $p_0=3-2r$ | $p+4x+6$，选H | $p+4(x-y)+10$，选D |

### 解题技巧

1. **直线算法**：先判断斜率确定主方向
2. **圆算法**：利用八对称性减少计算
3. **射线法**：注意顶点的特殊处理
4. **矢量运算**：按公式逐步计算，注意符号

---

## 补充知识点

### 7. 三种直线算法的比较

| 特性 | DDA | 中点画线 | Bresenham |
|------|-----|----------|-----------|
| 运算类型 | 浮点 | 整数 | 整数 |
| 效率 | 低 | 高 | 最高 |
| 精度 | 有累积误差 | 无累积误差 | 无累积误差 |
| 硬件实现 | 困难 | 容易 | 最容易 |
| 使用范围 | 教学 | 实际应用 | 最广泛 |

### 8. 填充算法的选择

| 场景 | 推荐算法 |
|------|----------|
| 大面积多边形 | 扫描线填充 |
| 交互式填充 | 种子填充 |
| 复杂边界 | 扫描线种子填充 |
| 简单图形 | 边填充 |

### 9. 反走样技术的选择

| 应用场景 | 推荐技术 |
|----------|----------|
| 实时应用 | 像素细分（简单） |
| 高质量渲染 | 区域采样 |
| 交互式应用 | 自适应算法 |
| 硬件加速 | 多重采样（MSAA） |
