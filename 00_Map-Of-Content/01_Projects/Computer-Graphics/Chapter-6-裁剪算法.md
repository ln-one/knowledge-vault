# 第六章 裁剪算法

> **期中/期末考试分值：12分**（计算题6分 + 绘图题5分 + 简答题）

---

## 1. 裁剪概述

### 1.1 裁剪的基本概念

**定义：**
裁剪（Clipping）是判断图形元素是否在裁剪窗口之内，并找出其位于内部的部分的过程。

**裁剪的目的：**
- 只显示窗口内的图形内容
- 提高图形显示效率
- 实现视图变换的关键步骤

### 1.2 裁剪窗口类型

- 矩形窗口（最常用）
- 圆形窗口
- 一般多边形窗口

### 1.3 被裁剪对象

- 线段
- 多边形
- 曲线
- 字符

### 1.4 裁剪与覆盖的区别

**裁剪：** 判断图形元素是否在窗口内，保留窗口内部分
**覆盖：** 用一个图形遮挡另一个图形

---

## 2. 直线裁剪算法【重点算法】

### 2.1 点的裁剪

**点在矩形窗口内的充要条件：**

设窗口边界为 $[x_{min}, x_{max}] \times [y_{min}, y_{max}]$，点 $(x, y)$ 在窗口内当且仅当：

$$x_{min} \leq x \leq x_{max} \quad \text{且} \quad y_{min} \leq y \leq y_{max}$$

### 2.2 线段与窗口的位置关系

待裁剪线段和窗口的关系有三种：
1. **完全可见**：线段完全落在窗口内
2. **显然不可见**：线段完全落在窗口外
3. **部分可见**：线段部分在内，部分在外

**重要性质：** 任何平面线段在凸多边形窗口进行裁剪后，落在窗口内的线段不会多于1条。

---

## 3. Cohen-Sutherland算法【高频考点】

### 3.1 算法基本思想

也称为**编码裁剪算法**，通过对线段端点进行编码，快速判断线段的可见性。

**核心思想：**
- 用编码方法快速判断"完全可见"和"显然不可见"的线段
- 减少求交计算次数

### 3.2 区域编码方法

由窗口四条边所在直线把二维平面分成9个区域，每个区域赋予一个4位编码 $C_tC_bC_rC_l$：

```
        |        |
  1001  |  1000  |  1010
        |        |
--------+--------+--------  y_max
        |        |
  0001  |  0000  |  0010
        |        |
--------+--------+--------  y_min
        |        |
  0101  |  0100  |  0110
        |        |
      x_min    x_max
```

**编码规则：**
- $C_l = 1$：点在窗口左边界左侧（$x < x_{min}$）
- $C_r = 1$：点在窗口右边界右侧（$x > x_{max}$）
- $C_b = 1$：点在窗口下边界下方（$y < y_{min}$）
- $C_t = 1$：点在窗口上边界上方（$y > y_{max}$）

**编码计算：**
```
C_l = (x < x_min) ? 1 : 0
C_r = (x > x_max) ? 1 : 0
C_b = (y < y_min) ? 1 : 0
C_t = (y > y_max) ? 1 : 0
编码 = C_t × 8 + C_b × 4 + C_r × 2 + C_l × 1
```

### 3.3 快速判断规则

设线段两端点编码分别为 $code_1$ 和 $code_2$：

**完全可见判断：**
$$code_1 = 0 \quad \text{且} \quad code_2 = 0$$
两端点编码都为0000，线段完全在窗口内。

**显然不可见判断：**
$$code_1 \text{ AND } code_2 \neq 0$$
两端点编码按位与运算结果非零，线段完全在窗口外。

### 3.4 算法步骤

1. 计算线段两端点 $P_1$、$P_2$ 的编码 $code_1$、$code_2$
2. 若 $code_1 = code_2 = 0$，线段完全可见，保留并结束
3. 若 $code_1 \text{ AND } code_2 \neq 0$，线段显然不可见，丢弃并结束
4. 否则，线段部分可见：
   - 选择一个在窗口外的端点（编码非零）
   - 按顺序（左、右、下、上）测试该端点编码的各位
   - 若某位为1，计算线段与对应窗口边的交点
   - 用交点替换窗口外的端点
   - 重复步骤1-4

### 3.5 求交计算

设线段端点为 $P_1(x_1, y_1)$ 和 $P_2(x_2, y_2)$：

**与左边界 $x = x_{min}$ 求交：**
$$y = y_1 + \frac{y_2 - y_1}{x_2 - x_1}(x_{min} - x_1)$$

**与右边界 $x = x_{max}$ 求交：**
$$y = y_1 + \frac{y_2 - y_1}{x_2 - x_1}(x_{max} - x_1)$$

**与下边界 $y = y_{min}$ 求交：**
$$x = x_1 + \frac{x_2 - x_1}{y_2 - y_1}(y_{min} - y_1)$$

**与上边界 $y = y_{max}$ 求交：**
$$x = x_1 + \frac{x_2 - x_1}{y_2 - y_1}(y_{max} - y_1)$$


### 3.6 【去年真题示例】Cohen-Sutherland算法计算题（6分）

**题目：** 已知裁剪窗口为 $x_{min}=1$，$x_{max}=5$，$y_{min}=1$，$y_{max}=4$，用Cohen-Sutherland算法裁剪线段 $P_1(0, 2)P_2(6, 5)$。

**解答步骤：**

**第一步：计算端点编码**（1分）

对于 $P_1(0, 2)$：
- $x = 0 < x_{min} = 1$，所以 $C_l = 1$
- $x = 0 < x_{max} = 5$，所以 $C_r = 0$
- $y = 2 > y_{min} = 1$，所以 $C_b = 0$
- $y = 2 < y_{max} = 4$，所以 $C_t = 0$
- $code_1 = 0001$

对于 $P_2(6, 5)$：
- $x = 6 > x_{max} = 5$，所以 $C_r = 1$
- $y = 5 > y_{max} = 4$，所以 $C_t = 1$
- $code_2 = 1010$

**第二步：判断可见性**（1分）

- $code_1 \text{ AND } code_2 = 0001 \text{ AND } 1010 = 0000 = 0$
- 不能判断为显然不可见，需要求交

**第三步：处理端点 $P_1$**（1分）

$P_1$ 编码为0001，$C_l = 1$，与左边界 $x = 1$ 求交：

$$y = y_1 + \frac{y_2 - y_1}{x_2 - x_1}(x_{min} - x_1) = 2 + \frac{5-2}{6-0}(1-0) = 2 + \frac{3}{6} = 2.5$$

交点 $P_1' = (1, 2.5)$，编码为0000

**第四步：处理端点 $P_2$**（2分）

$P_2$ 编码为1010，先处理 $C_r = 1$，与右边界 $x = 5$ 求交：

$$y = 2 + \frac{5-2}{6-0}(5-0) = 2 + \frac{3}{6} \times 5 = 2 + 2.5 = 4.5$$

交点 $P_2' = (5, 4.5)$，编码为1000（$y = 4.5 > y_{max} = 4$）

继续处理 $C_t = 1$，与上边界 $y = 4$ 求交：

$$x = 0 + \frac{6-0}{5-2}(4-2) = \frac{6}{3} \times 2 = 4$$

交点 $P_2'' = (4, 4)$，编码为0000

**第五步：得出结果**（1分）

裁剪后的线段为 $P_1'(1, 2.5)P_2''(4, 4)$

### 3.7 算法特点

**优点：**
- 用编码方法可快速判断线段的可见性
- 适合大窗口场合（大部分线段完全可见）
- 适合小窗口场合（如光标拾取图形时）

**缺点：**
- 最坏情况下需要求交4次
- 对于部分可见线段，可能进行不必要的求交计算

---

## 4. 中点分割裁剪算法

### 4.1 算法基本思想

利用**对分搜索**思想，通过折半查找交点，用移位运算（除2）代替求交计算。

**核心思想：**
- 不断在中点处将线段一分为二
- 对每段线段重复Cohen-Sutherland算法的可见性测试
- 直至找到交点或分割子段足够小

### 4.2 算法步骤

1. 对线段 $P_1P_2$ 进行Cohen-Sutherland编码测试
2. 若完全可见或显然不可见，结束
3. 否则，计算中点 $P_m = \frac{P_1 + P_2}{2}$
4. 判断 $P_1$ 是否在窗口内：
   - 若 $P_1$ 在窗口外，用 $P_1P_m$ 代替 $P_1P_2$
   - 若 $P_1$ 在窗口内，用 $P_mP_2$ 代替 $P_1P_2$
5. 重复步骤1-4，直到：
   - 找到与窗口边界的交点
   - 或分割子段长度小于一个像素

### 4.3 中点计算

$$P_m = \left(\frac{x_1 + x_2}{2}, \frac{y_1 + y_2}{2}\right)$$

**优化：** 使用移位运算实现除2：
$$x_m = (x_1 + x_2) >> 1$$
$$y_m = (y_1 + y_2) >> 1$$

### 4.4 递归终止条件

当满足以下条件之一时停止递归：
1. 线段完全可见（两端点编码都为0）
2. 线段显然不可见（两端点编码按位与非零）
3. 线段长度小于1个像素（$|x_2 - x_1| < 1$ 且 $|y_2 - y_1| < 1$）

### 4.5 算法特点

**优点：**
- 用移位运算代替乘除法，适合硬件实现
- 算法简单，易于并行处理

**缺点：**
- 需要多次迭代才能找到精确交点
- 对于斜率较大的线段，迭代次数较多

---

## 5. Liang-Barsky算法【高频考点】

### 5.1 算法基本思想

由梁友栋和Barsky提出，基于**参数方程**的裁剪算法，把二维裁剪转化为一维裁剪问题。

**核心思想：**
- 用参数方程表示线段
- 通过参数值确定可见部分

### 5.2 线段的参数方程

设线段端点为 $P_1(x_1, y_1)$ 和 $P_2(x_2, y_2)$，参数方程为：

$$x = x_1 + t \cdot \Delta x = x_1 + t(x_2 - x_1)$$
$$y = y_1 + t \cdot \Delta y = y_1 + t(y_2 - y_1)$$

其中 $t \in [0, 1]$，$\Delta x = x_2 - x_1$，$\Delta y = y_2 - y_1$

### 5.3 裁剪条件

点 $(x, y)$ 在窗口内的条件：

$$x_{min} \leq x_1 + t \cdot \Delta x \leq x_{max}$$
$$y_{min} \leq y_1 + t \cdot \Delta y \leq y_{max}$$

可以统一写成：
$$t \cdot p_k \leq q_k \quad (k = 1, 2, 3, 4)$$

其中：
- $p_1 = -\Delta x$，$q_1 = x_1 - x_{min}$（左边界）
- $p_2 = \Delta x$，$q_2 = x_{max} - x_1$（右边界）
- $p_3 = -\Delta y$，$q_3 = y_1 - y_{min}$（下边界）
- $p_4 = \Delta y$，$q_4 = y_{max} - y_1$（上边界）

### 5.4 参数分析

对于每个 $k$：

**情况1：$p_k = 0$**
- 线段平行于第 $k$ 条边界
- 若 $q_k < 0$，线段完全在边界外，丢弃
- 若 $q_k \geq 0$，线段在边界内侧，继续检查其他边界

**情况2：$p_k < 0$**
- 线段从边界外部延伸到内部（进入边界）
- 计算参数 $t_k = q_k / p_k$
- 更新入边界参数：$t_1 = \max(t_1, t_k)$

**情况3：$p_k > 0$**
- 线段从边界内部延伸到外部（离开边界）
- 计算参数 $t_k = q_k / p_k$
- 更新出边界参数：$t_2 = \min(t_2, t_k)$

### 5.5 算法步骤

1. 初始化 $t_1 = 0$，$t_2 = 1$
2. 计算 $p_k$ 和 $q_k$（$k = 1, 2, 3, 4$）
3. 对于每个 $k$：
   - 若 $p_k = 0$ 且 $q_k < 0$，线段不可见，结束
   - 若 $p_k < 0$，$t_1 = \max(t_1, q_k/p_k)$
   - 若 $p_k > 0$，$t_2 = \min(t_2, q_k/p_k)$
4. 若 $t_1 > t_2$，线段不可见
5. 否则，可见部分的端点为：
   - $(x_1 + t_1 \cdot \Delta x, y_1 + t_1 \cdot \Delta y)$
   - $(x_1 + t_2 \cdot \Delta x, y_1 + t_2 \cdot \Delta y)$


### 5.6 【去年真题示例】Liang-Barsky算法计算题（6分）

**题目：** 已知裁剪窗口为 $x_{min}=0$，$x_{max}=4$，$y_{min}=0$，$y_{max}=3$，用Liang-Barsky算法裁剪线段 $P_1(-1, 1)P_2(5, 4)$。

**解答步骤：**

**第一步：计算参数**（1分）

$$\Delta x = x_2 - x_1 = 5 - (-1) = 6$$
$$\Delta y = y_2 - y_1 = 4 - 1 = 3$$

**第二步：计算 $p_k$ 和 $q_k$**（2分）

| k | 边界 | $p_k$ | $q_k$ | $q_k/p_k$ |
|---|------|-------|-------|-----------|
| 1 | 左 | $-\Delta x = -6$ | $x_1 - x_{min} = -1 - 0 = -1$ | $1/6$ |
| 2 | 右 | $\Delta x = 6$ | $x_{max} - x_1 = 4 - (-1) = 5$ | $5/6$ |
| 3 | 下 | $-\Delta y = -3$ | $y_1 - y_{min} = 1 - 0 = 1$ | $-1/3$ |
| 4 | 上 | $\Delta y = 3$ | $y_{max} - y_1 = 3 - 1 = 2$ | $2/3$ |

**第三步：计算 $t_1$ 和 $t_2$**（2分）

初始化：$t_1 = 0$，$t_2 = 1$

- $k=1$：$p_1 = -6 < 0$（进入边界），$t_1 = \max(0, 1/6) = 1/6$
- $k=2$：$p_2 = 6 > 0$（离开边界），$t_2 = \min(1, 5/6) = 5/6$
- $k=3$：$p_3 = -3 < 0$（进入边界），$t_1 = \max(1/6, -1/3) = 1/6$
- $k=4$：$p_4 = 3 > 0$（离开边界），$t_2 = \min(5/6, 2/3) = 2/3$

**第四步：判断可见性并计算端点**（1分）

$t_1 = 1/6 < t_2 = 2/3$，线段部分可见

可见部分端点：
$$P_1' = (-1 + \frac{1}{6} \times 6, 1 + \frac{1}{6} \times 3) = (0, 1.5)$$
$$P_2' = (-1 + \frac{2}{3} \times 6, 1 + \frac{2}{3} \times 3) = (3, 3)$$

**答案：** 裁剪后的线段为 $P_1'(0, 1.5)P_2'(3, 3)$

### 5.7 算法特点

**优点：**
- 只需计算4次除法（最坏情况）
- 比Cohen-Sutherland算法效率更高
- 算法逻辑清晰，易于实现

**缺点：**
- 需要进行浮点运算
- 对于完全可见或显然不可见的线段，没有Cohen-Sutherland算法快

---

## 6. 三种直线裁剪算法比较【简答题考点】

| 算法 | 基本思想 | 优点 | 缺点 | 适用场景 |
|------|----------|------|------|----------|
| Cohen-Sutherland | 编码判断 | 快速判断可见性 | 最坏求交4次 | 大/小窗口 |
| 中点分割 | 二分查找 | 硬件实现简单 | 迭代次数多 | 硬件裁剪 |
| Liang-Barsky | 参数方程 | 效率高，最多4次除法 | 浮点运算 | 通用场景 |

**效率比较：**
- 对于完全可见线段：Cohen-Sutherland最快
- 对于部分可见线段：Liang-Barsky最快
- 对于显然不可见线段：Cohen-Sutherland最快

---


## 7. 多边形裁剪【重点算法】

### 7.1 多边形裁剪的特殊性

**为什么不能直接用线段裁剪？**

多边形裁剪不是简单的线段裁剪组合，存在以下问题：

1. **边界不封闭问题**：裁剪后的多边形边界可能不再封闭，需要用窗口边界的恰当部分来封闭
2. **顶点信息丢失**：直接对边进行裁剪会丢失顶点信息，无法确定裁剪区域
3. **多边形分裂**：裁剪结果可能分裂为多个独立的多边形

**裁剪后顶点的来源：**
- 原多边形在窗口内的顶点
- 多边形边与窗口边界的交点
- 窗口的角点（某些情况下）

### 7.2 多边形与窗口边的位置关系

对于多边形的每条边 $P_iP_{i+1}$ 与裁剪边的关系：

```
情况(a)：两端点都在内侧 → 输出 P_{i+1}
情况(b)：两端点都在外侧 → 无输出
情况(c)：从内到外 → 输出交点 I
情况(d)：从外到内 → 输出交点 I 和 P_{i+1}
```

---

## 8. Sutherland-Hodgman算法【高频考点】

### 8.1 算法基本思想

也称为**逐边裁剪算法**，采用分割处理策略：将多边形关于矩形窗口的裁剪分解为多边形关于窗口四边所在直线的裁剪。

**裁剪顺序：** 左 → 上 → 右 → 下（或其他顺序）

### 8.2 单边裁剪规则

对于多边形的每条边 $P_iP_{i+1}$，根据两端点相对于裁剪边的位置，有四种情况：

| 情况 | $P_i$ 位置 | $P_{i+1}$ 位置 | 输出 |
|------|-----------|---------------|------|
| (a) | 内侧 | 内侧 | $P_{i+1}$ |
| (b) | 外侧 | 外侧 | 无 |
| (c) | 内侧 | 外侧 | 交点 $I$ |
| (d) | 外侧 | 内侧 | 交点 $I$ 和 $P_{i+1}$ |

### 8.3 算法步骤

1. 依次用窗口的四条边作为裁剪边
2. 对于每条裁剪边，遍历多边形的所有边
3. 根据上述四种情况，生成新的顶点序列
4. 将新顶点序列作为下一条裁剪边的输入
5. 重复直到四条边都处理完毕

### 8.4 【去年真题示例】Sutherland-Hodgman算法（6分）

**题目：** 用Sutherland-Hodgman算法裁剪三角形ABC，顶点为A(1,1)、B(5,1)、C(3,4)，裁剪窗口为 $x_{min}=2$，$x_{max}=4$，$y_{min}=0$，$y_{max}=3$。

**解答步骤：**

**第一步：对左边界 $x=2$ 裁剪**（1.5分）

输入顶点：A(1,1) → B(5,1) → C(3,4) → A(1,1)

| 边 | $P_i$ | $P_{i+1}$ | 情况 | 输出 |
|----|-------|-----------|------|------|
| AB | A(1,1)外 | B(5,1)内 | (d) | I₁(2,1), B(5,1) |
| BC | B(5,1)内 | C(3,4)内 | (a) | C(3,4) |
| CA | C(3,4)内 | A(1,1)外 | (c) | I₂(2,2.5) |

输出顶点：I₁(2,1), B(5,1), C(3,4), I₂(2,2.5)

**第二步：对右边界 $x=4$ 裁剪**（1.5分）

输入顶点：I₁(2,1) → B(5,1) → C(3,4) → I₂(2,2.5) → I₁(2,1)

| 边 | $P_i$ | $P_{i+1}$ | 情况 | 输出 |
|----|-------|-----------|------|------|
| I₁B | I₁(2,1)内 | B(5,1)外 | (c) | I₃(4,1) |
| BC | B(5,1)外 | C(3,4)内 | (d) | I₄(4,2.5), C(3,4) |
| CI₂ | C(3,4)内 | I₂(2,2.5)内 | (a) | I₂(2,2.5) |
| I₂I₁ | I₂(2,2.5)内 | I₁(2,1)内 | (a) | I₁(2,1) |

输出顶点：I₃(4,1), I₄(4,2.5), C(3,4), I₂(2,2.5), I₁(2,1)

**第三步：对上边界 $y=3$ 裁剪**（1.5分）

输入顶点：I₃(4,1) → I₄(4,2.5) → C(3,4) → I₂(2,2.5) → I₁(2,1) → I₃(4,1)

| 边 | $P_i$ | $P_{i+1}$ | 情况 | 输出 |
|----|-------|-----------|------|------|
| I₃I₄ | I₃(4,1)内 | I₄(4,2.5)内 | (a) | I₄(4,2.5) |
| I₄C | I₄(4,2.5)内 | C(3,4)外 | (c) | I₅(3.5,3) |
| CI₂ | C(3,4)外 | I₂(2,2.5)内 | (d) | I₆(2.5,3), I₂(2,2.5) |
| I₂I₁ | I₂(2,2.5)内 | I₁(2,1)内 | (a) | I₁(2,1) |
| I₁I₃ | I₁(2,1)内 | I₃(4,1)内 | (a) | I₃(4,1) |

输出顶点：I₄(4,2.5), I₅(3.5,3), I₆(2.5,3), I₂(2,2.5), I₁(2,1), I₃(4,1)

**第四步：对下边界 $y=0$ 裁剪**（1.5分）

所有顶点的y坐标都大于0，无需裁剪。

**答案：** 裁剪后的多边形顶点为：I₄(4,2.5), I₅(3.5,3), I₆(2.5,3), I₂(2,2.5), I₁(2,1), I₃(4,1)

### 8.5 凹多边形的问题

**问题：** Sutherland-Hodgman算法对凹多边形裁剪时，可能产生多余的边。

当凹多边形被裁剪后分裂为多个独立区域时，算法会在这些区域之间产生沿窗口边界的连接线段。

**解决方案：** 使用Weiler-Atherton算法

### 8.6 算法特点

**优点：**
- 算法简单，易于实现
- 可推广到任意凸多边形裁剪窗口

**缺点：**
- 对凹多边形裁剪可能产生多余边
- 不能正确处理带孔的多边形

---

## 9. Weiler-Atherton算法

### 9.1 算法基本思想

能够正确处理凹多边形和带孔多边形的裁剪算法。

**基本概念：**
- **主多边形（SP）**：被裁剪的多边形
- **裁剪多边形（CP）**：裁剪窗口

**约定：**
- SP和CP均用顶点的环形链表定义
- 外边界取顺时针方向
- 内边界取逆时针方向
- 沿多边形边走动时，右边为多边形内部

### 9.2 交点分类

**进点（Entering Point）：** SP边界由此进入CP内部
**出点（Exiting Point）：** SP边界由此离开CP内部

如果SP与CP有交点，则交点成对出现，交替为进点和出点。

### 9.3 算法步骤

**内裁剪（求 SP ∩ CP）：**

1. 计算SP和CP的所有交点，标记为进点或出点
2. 将交点按顺序插入SP和CP的顶点链表中
3. 从任意一个进点出发
4. 沿SP的边前进，收集顶点
5. 遇到出点时，转到CP的边上前进
6. 遇到进点时，转回SP的边上前进
7. 重复步骤4-6，直到回到起始点
8. 如果还有未访问的进点，重复步骤3-7

### 9.4 跟踪规则

| 当前位置 | 遇到的点类型 | 操作 |
|----------|-------------|------|
| 在SP边上 | 进点 | 沿SP边继续，收集顶点 |
| 在SP边上 | 出点 | 转到CP边上，沿CP边前进 |
| 在CP边上 | 进点 | 转到SP边上，沿SP边前进 |
| 在CP边上 | 出点 | 沿CP边继续，收集顶点 |

### 9.5 算法示例

设主多边形SP顶点为：S₁ → S₂ → S₃ → S₄ → S₅ → S₆
裁剪多边形CP顶点为：C₁ → C₂ → C₃ → C₄

交点为：I₁(进), I₂(出), I₃(进), I₄(出), I₅(进), I₆(出), I₇(进), I₈(出)

**跟踪过程：**
从I₁出发 → 沿SP到I₂ → 转到CP，沿CP到I₃ → 转到SP，沿SP到S₃ → 到I₄ → 转到CP，沿CP到I₅ → ...

### 9.6 算法特点

**优点：**
- 能正确处理凹多边形
- 能处理带孔的多边形
- 裁剪结果可能是多个独立的多边形

**缺点：**
- 算法复杂度较高
- 需要维护复杂的数据结构

---

## 10. 凸多边形与凹多边形的处理

### 10.1 凸多边形

**定义：** 多边形内任意两点的连线都在多边形内部。

**特点：**
- 裁剪后最多产生一个多边形
- 可以使用Sutherland-Hodgman算法

### 10.2 凹多边形

**定义：** 存在两点，其连线有部分在多边形外部。

**特点：**
- 裁剪后可能产生多个独立的多边形
- 应使用Weiler-Atherton算法

### 10.3 判断多边形凹凸性

**方法：** 计算相邻边的叉积

对于顶点序列 $P_0, P_1, ..., P_{n-1}$，计算：
$$\vec{v_i} = P_{i+1} - P_i$$
$$cross_i = \vec{v_i} \times \vec{v_{i+1}}$$

- 如果所有 $cross_i$ 同号，则为凸多边形
- 如果 $cross_i$ 有正有负，则为凹多边形

---


## 11. 三维裁剪算法

### 11.1 三维裁剪概述

**三维裁剪的目的：**
- 确定三维场景中哪些物体在视野范围内
- 是三维图形显示流程的重要环节

**三维图形显示流程：**
```
三维世界坐标系 → 三维裁剪 → 投影 → 窗口到视区变换 → 二维屏幕坐标系
```

### 11.2 三维裁剪窗口类型

1. **长方体（Cuboid）**：六个平面围成的矩形区域
2. **视椎体（View Frustum）**：透视投影的可视区域

---

## 12. 长方体裁剪算法

### 12.1 长方体裁剪窗口

**定义：** 由六个平面围成的矩形区域

$$x_{min} \leq x \leq x_{max}$$
$$y_{min} \leq y \leq y_{max}$$
$$z_{min} \leq z \leq z_{max}$$

### 12.2 三维Cohen-Sutherland算法

将二维的4位编码扩展为6位编码：$C_{far}C_{near}C_tC_bC_rC_l$

**编码规则：**
- $C_l = 1$：$x < x_{min}$（左）
- $C_r = 1$：$x > x_{max}$（右）
- $C_b = 1$：$y < y_{min}$（下）
- $C_t = 1$：$y > y_{max}$（上）
- $C_{near} = 1$：$z < z_{min}$（近）
- $C_{far} = 1$：$z > z_{max}$（远）

**区域划分：**
三维空间被6个平面分成27个区域，每个区域对应一个6位编码。

### 12.3 判断规则

与二维算法类似：

**完全可见：**
$$code_1 = 0 \quad \text{且} \quad code_2 = 0$$

**显然不可见：**
$$code_1 \text{ AND } code_2 \neq 0$$

### 12.4 求交计算

设线段端点为 $P_1(x_1, y_1, z_1)$ 和 $P_2(x_2, y_2, z_2)$：

**与 $x = x_{min}$ 平面求交：**
$$t = \frac{x_{min} - x_1}{x_2 - x_1}$$
$$y = y_1 + t(y_2 - y_1)$$
$$z = z_1 + t(z_2 - z_1)$$

**与 $z = z_{min}$ 平面求交：**
$$t = \frac{z_{min} - z_1}{z_2 - z_1}$$
$$x = x_1 + t(x_2 - x_1)$$
$$y = y_1 + t(y_2 - y_1)$$

其他平面的求交方法类似。

---

## 13. 视椎体裁剪算法【重点】

### 13.1 视椎体的定义

**视椎体（View Frustum）** 是透视投影中的可视区域，由以下六个平面围成：
- 近裁剪面（Near Plane）
- 远裁剪面（Far Plane）
- 左裁剪面（Left Plane）
- 右裁剪面（Right Plane）
- 上裁剪面（Top Plane）
- 下裁剪面（Bottom Plane）

```
        远裁剪面
       /--------\
      /          \
     /            \
    /   视椎体     \
   /                \
  /------------------\
        近裁剪面
         |
       视点
```

### 13.2 视椎体参数

**透视投影参数：**
- $n$：近裁剪面距离
- $f$：远裁剪面距离
- $fov$：视场角（Field of View）
- $aspect$：宽高比

**近裁剪面尺寸：**
$$h_{near} = 2n \cdot \tan(fov/2)$$
$$w_{near} = aspect \cdot h_{near}$$

**远裁剪面尺寸：**
$$h_{far} = 2f \cdot \tan(fov/2)$$
$$w_{far} = aspect \cdot h_{far}$$

### 13.3 裁剪面方程

设视点在原点，观察方向为-z轴：

**近裁剪面：** $z = -n$
**远裁剪面：** $z = -f$

**左裁剪面：** 过原点，法向量为 $(n, 0, w_{near}/2)$
**右裁剪面：** 过原点，法向量为 $(-n, 0, w_{near}/2)$
**上裁剪面：** 过原点，法向量为 $(0, -n, h_{near}/2)$
**下裁剪面：** 过原点，法向量为 $(0, n, h_{near}/2)$

### 13.4 齐次坐标裁剪

在齐次坐标系中，经过透视变换后的点 $(x, y, z, w)$ 在视椎体内的条件：

$$-w \leq x \leq w$$
$$-w \leq y \leq w$$
$$-w \leq z \leq w$$

这简化了裁剪计算，因为所有六个裁剪面都变成了简单的形式。

### 13.5 三维Liang-Barsky算法

将二维Liang-Barsky算法扩展到三维：

**参数方程：**
$$x = x_1 + t \cdot \Delta x$$
$$y = y_1 + t \cdot \Delta y$$
$$z = z_1 + t \cdot \Delta z$$

**裁剪条件：**
$$t \cdot p_k \leq q_k \quad (k = 1, 2, ..., 6)$$

其中：
- $p_1 = -\Delta x$，$q_1 = x_1 - x_{min}$
- $p_2 = \Delta x$，$q_2 = x_{max} - x_1$
- $p_3 = -\Delta y$，$q_3 = y_1 - y_{min}$
- $p_4 = \Delta y$，$q_4 = y_{max} - y_1$
- $p_5 = -\Delta z$，$q_5 = z_1 - z_{min}$
- $p_6 = \Delta z$，$q_6 = z_{max} - z_1$

算法步骤与二维情况相同，只是需要处理6个边界。

---

## 14. 三维裁剪在渲染管线中的位置

### 14.1 图形渲染管线

```
顶点数据 → 顶点着色器 → 图元装配 → 几何着色器 → 裁剪 → 光栅化 → 片段着色器 → 输出
```

### 14.2 裁剪阶段的作用

1. **剔除不可见物体**：完全在视椎体外的物体直接丢弃
2. **裁剪部分可见物体**：计算与视椎体边界的交点
3. **生成新顶点**：为裁剪后的图元生成新的顶点数据

### 14.3 裁剪与其他技术的关系

**与背面剔除的区别：**
- 背面剔除：剔除背向观察者的面
- 裁剪：剔除视椎体外的部分

**与遮挡剔除的区别：**
- 遮挡剔除：剔除被其他物体遮挡的部分
- 裁剪：只考虑视椎体边界

### 14.4 硬件裁剪

现代GPU在硬件层面实现裁剪：
- 使用齐次坐标简化计算
- 并行处理多个图元
- 自动生成裁剪后的新顶点

---


## 15. 考试重点与真题解析

### 15.1 考试分值分布

| 题型 | 分值 | 考点 |
|------|------|------|
| 计算题 | 6分 | Cohen-Sutherland算法、Liang-Barsky算法 |
| 绘图题 | 5分 | 裁剪过程图解、Sutherland-Hodgman算法 |
| 简答题 | 5分 | 算法比较、基本概念 |

### 15.2 高频考点

1. **Cohen-Sutherland算法**：编码方法、判断规则、求交计算
2. **Liang-Barsky算法**：参数方程、$p_k$和$q_k$的计算
3. **Sutherland-Hodgman算法**：逐边裁剪过程
4. **算法比较**：三种直线裁剪算法的优缺点

---

### 15.3 【简答题】裁剪算法比较（5分）

**题目：** 比较Cohen-Sutherland算法、中点分割算法和Liang-Barsky算法的特点。

**标准答案：**

**Cohen-Sutherland算法：**（2分）
- 基本思想：通过端点编码快速判断线段可见性
- 优点：对完全可见和显然不可见的线段判断速度快
- 缺点：对部分可见线段可能需要多次求交
- 适用场景：大窗口或小窗口（光标拾取）

**中点分割算法：**（1.5分）
- 基本思想：用二分法查找交点，用移位运算代替乘除
- 优点：适合硬件实现，算法简单
- 缺点：需要多次迭代，精度受限

**Liang-Barsky算法：**（1.5分）
- 基本思想：用参数方程表示线段，通过参数值确定可见部分
- 优点：效率高，最多4次除法
- 缺点：需要浮点运算

---

### 15.4 【绘图题】裁剪过程图解（5分）

**题目：** 画出用Cohen-Sutherland算法裁剪线段P₁P₂的过程，其中P₁在窗口左下方，P₂在窗口右上方。

**标准答案：**

```
        y_max ----+--------+----
                  |        |
                  |   P₂'  | P₂
                  |    *   |  *
        y_min ----+--------+----
                  |        |
             P₁   | P₁'    |
              *   |  *     |
                  |        |
              x_min      x_max
```

**解答要点：**（5分）
1. 正确标注窗口边界和端点位置（1分）
2. 标注P₁的编码为0101（左下）（1分）
3. 标注P₂的编码为1010（右上）（1分）
4. 画出与左边界的交点P₁'（1分）
5. 画出与上边界的交点P₂'（1分）

---

### 15.5 【计算题】综合裁剪计算（6分）

**题目：** 已知裁剪窗口为 $x_{min}=0$，$x_{max}=6$，$y_{min}=0$，$y_{max}=4$，线段端点为P₁(-2, 1)和P₂(8, 6)。

（1）用Cohen-Sutherland算法计算端点编码
（2）判断线段可见性
（3）计算裁剪后的线段端点

**解答步骤：**

**（1）计算端点编码**（2分）

P₁(-2, 1)：
- $x = -2 < 0 = x_{min}$，$C_l = 1$
- $y = 1$，$0 \leq 1 \leq 4$，$C_b = C_t = 0$
- $code_1 = 0001$

P₂(8, 6)：
- $x = 8 > 6 = x_{max}$，$C_r = 1$
- $y = 6 > 4 = y_{max}$，$C_t = 1$
- $code_2 = 1010$

**（2）判断可见性**（1分）

$code_1 \text{ AND } code_2 = 0001 \text{ AND } 1010 = 0000$

按位与结果为0，不能判断为显然不可见，需要求交。

**（3）计算裁剪后端点**（3分）

处理P₁（与左边界求交）：
$$y = 1 + \frac{6-1}{8-(-2)}(0-(-2)) = 1 + \frac{5}{10} \times 2 = 2$$
P₁' = (0, 2)，编码为0000

处理P₂（先与右边界求交）：
$$y = 1 + \frac{6-1}{8-(-2)}(6-(-2)) = 1 + \frac{5}{10} \times 8 = 5$$
交点(6, 5)，编码为1000（$y = 5 > 4$）

继续与上边界求交：
$$x = -2 + \frac{8-(-2)}{6-1}(4-1) = -2 + \frac{10}{5} \times 3 = 4$$
P₂' = (4, 4)，编码为0000

**答案：** 裁剪后的线段为P₁'(0, 2)P₂'(4, 4)

---

### 15.6 【计算题】Sutherland-Hodgman算法（6分）

**题目：** 用Sutherland-Hodgman算法对矩形ABCD进行裁剪，顶点为A(0,0)、B(4,0)、C(4,3)、D(0,3)，裁剪窗口左边界为x=1。

**解答步骤：**

**输入顶点序列：** A(0,0) → B(4,0) → C(4,3) → D(0,3) → A(0,0)

| 边 | 起点 | 终点 | 起点位置 | 终点位置 | 情况 | 输出 |
|----|------|------|----------|----------|------|------|
| AB | A(0,0) | B(4,0) | 外(x<1) | 内(x>1) | (d) | I₁(1,0), B(4,0) |
| BC | B(4,0) | C(4,3) | 内 | 内 | (a) | C(4,3) |
| CD | C(4,3) | D(0,3) | 内 | 外 | (c) | I₂(1,3) |
| DA | D(0,3) | A(0,0) | 外 | 外 | (b) | 无 |

**交点计算：**

I₁：AB与x=1的交点
$$y = 0 + \frac{0-0}{4-0}(1-0) = 0$$
I₁ = (1, 0)

I₂：CD与x=1的交点
$$y = 3 + \frac{3-3}{0-4}(1-4) = 3$$
I₂ = (1, 3)

**答案：** 裁剪后的多边形顶点为：I₁(1,0), B(4,0), C(4,3), I₂(1,3)

---

## 16. 考试重点总结

### 16.1 必考知识点

**计算题必考：**
- Cohen-Sutherland算法的编码和求交
- Liang-Barsky算法的参数计算
- Sutherland-Hodgman算法的逐边裁剪

**简答题必考：**
- 裁剪的基本概念和目的
- 三种直线裁剪算法的比较
- 多边形裁剪的特殊性

### 16.2 解题技巧

**Cohen-Sutherland算法：**
1. 先画图标注端点位置
2. 按规则计算编码（左右下上）
3. 先判断完全可见和显然不可见
4. 求交时注意选择正确的边界

**Liang-Barsky算法：**
1. 先计算Δx和Δy
2. 按公式计算p和q
3. 注意p的正负决定是进入还是离开边界
4. 最后比较t₁和t₂判断可见性

**Sutherland-Hodgman算法：**
1. 明确裁剪边的内外侧
2. 按四种情况逐边处理
3. 注意输出顶点的顺序

### 16.3 常见错误

1. **编码计算错误**：混淆边界条件的等号
2. **求交公式错误**：分子分母搞反
3. **参数符号错误**：p的正负判断错误
4. **顶点顺序错误**：多边形裁剪时输出顺序混乱
5. **遗漏情况**：忘记处理某些边界

---

## 补充知识点

### 17. 裁剪算法的应用

#### 17.1 图形显示系统

- 窗口系统中的视图裁剪
- CAD软件中的局部放大
- 游戏引擎中的视椎体剔除

#### 17.2 图像处理

- 图像裁剪和缩放
- 区域选择和编辑

#### 17.3 三维渲染

- 视椎体裁剪
- 阴影体裁剪
- 反射和折射计算

### 18. 与其他章节的联系

**前置知识：**
- 第五章：图形变换（坐标变换）
- 第三章：直线生成算法（线段表示）

**后续应用：**
- 消隐算法：裁剪是消隐的基础
- 光照计算：确定可见区域
- 纹理映射：裁剪纹理坐标

**综合应用：**
- 三维场景渲染流水线
- 实时图形渲染优化
- 虚拟现实和增强现实

