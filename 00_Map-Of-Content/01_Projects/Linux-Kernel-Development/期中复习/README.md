# Linux内核分析 - 期中复习资料

> 📚 **课程**：Linux内核分析  
> 👨‍🏫 **教师**：Hu Xiaopeng  
> 🏫 **学校**：西南交通大学 计算与人工智能学院  
> 📅 **整理时间**：2025年11月

---

## 📂 资料结构

```
期中复习/
├── 00-课程概览.md          课程信息、考核方式、学习建议
├── 01-保护模式基础.md      GDT、描述符、选择子
├── 02-特权级机制.md        CPL、DPL、RPL（⭐⭐⭐⭐⭐）
├── 03-调用门与栈切换.md    特权级转移（⭐⭐⭐⭐⭐）
├── 04-分页机制.md          地址转换、页表
├── 05-中断与异常.md        IDT、中断处理
├── 06-ELF文件格式.md       可执行文件结构
├── 07-实验代码详解.md      pmtest1、pmtest5分析
└── 08-考点总结.md          题型分析、答题技巧（⭐⭐⭐⭐⭐）
```

---

## 🎯 学习路线

### 第一阶段：基础概念（2-3小时）

```mermaid
graph LR
    A[00-课程概览] --> B[01-保护模式基础]
    B --> C[理解GDT/描述符/选择子]
    
    style A fill:#e1f5ff
    style B fill:#fff9c4
    style C fill:#c8e6c9
```

**学习目标**：
- ✅ 理解实模式和保护模式的区别
- ✅ 掌握GDT、描述符、选择子的概念
- ✅ 能够计算选择子

**推荐时间**：2小时

---

### 第二阶段：核心机制（5-6小时）⭐⭐⭐⭐⭐

```mermaid
graph LR
    A[02-特权级机制] --> B[03-调用门与栈切换]
    B --> C[理解特权级转移]
    
    style A fill:#ffcdd2
    style B fill:#ffcdd2
    style C fill:#c8e6c9
```

**学习目标**：
- ✅ 掌握CPL、DPL、RPL的含义和检查规则
- ✅ 理解调用门的作用和使用方法
- ✅ 掌握TSS和栈切换的原理
- ✅ 能够实现Ring 0 ↔ Ring 3转移

**推荐时间**：5小时（重点！）

---

### 第三阶段：扩展知识（3-4小时）

```mermaid
graph LR
    A[04-分页机制] --> B[05-中断与异常]
    B --> C[06-ELF文件格式]
    
    style A fill:#fff9c4
    style B fill:#fff9c4
    style C fill:#fff9c4
```

**学习目标**：
- ✅ 理解分页机制和地址转换
- ✅ 了解中断、陷阱、异常的区别
- ✅ 了解ELF文件的基本结构

**推荐时间**：3小时

---

### 第四阶段：实战演练（3-4小时）

```mermaid
graph LR
    A[07-实验代码详解] --> B[08-考点总结]
    B --> C[模拟练习]
    
    style A fill:#bbdefb
    style B fill:#f8bbd0
    style C fill:#c8e6c9
```

**学习目标**：
- ✅ 理解pmtest1和pmtest5的代码
- ✅ 掌握常见题型和答题技巧
- ✅ 完成模拟练习

**推荐时间**：3小时

---

## 📊 重要程度标注

| 符号 | 重要程度 | 说明 |
|------|----------|------|
| ⭐⭐⭐⭐⭐ | 必考 | 必须完全掌握 |
| ⭐⭐⭐⭐ | 很重要 | 需要深入理解 |
| ⭐⭐⭐ | 重要 | 需要理解概念 |
| ⭐⭐ | 一般 | 了解即可 |

### 各章节重要程度

| 章节 | 重要程度 | 建议时间 |
|------|----------|----------|
| 00-课程概览 | ⭐⭐ | 30分钟 |
| 01-保护模式基础 | ⭐⭐⭐ | 2小时 |
| 02-特权级机制 | ⭐⭐⭐⭐⭐ | 3小时 |
| 03-调用门与栈切换 | ⭐⭐⭐⭐⭐ | 3小时 |
| 04-分页机制 | ⭐⭐⭐ | 2小时 |
| 05-中断与异常 | ⭐⭐ | 1.5小时 |
| 06-ELF文件格式 | ⭐⭐⭐ | 2小时 |
| 07-实验代码详解 | ⭐⭐⭐⭐ | 2小时 |
| 08-考点总结 | ⭐⭐⭐⭐⭐ | 2小时 |

---

## 🔥 核心知识点速查

### 1. GDT相关

```
GDT = 全局描述符表（数组）
描述符 = 段的"身份证"（8字节）
选择子 = GDT的"索引"（16位）
GDTR = 指向GDT的寄存器（48位）

公式：
选择子 = 偏移 + RPL（在GDT中）
线性地址 = 段基址 + 偏移
```

### 2. 特权级相关

```
CPL = 当前特权级（CS/SS的bit 0-1）
DPL = 描述符特权级（描述符中）
RPL = 请求特权级（选择子的bit 0-1）

检查规则：
数据段：max(CPL, RPL) ≤ DPL
代码段：CPL = DPL（非一致）
```

### 3. 调用门相关

```
调用门 = 特权级转移的"合法通道"
TSS = 保存各特权级的栈指针

检查规则：
1. max(CPL, RPL) ≤ 调用门DPL
2. 目标代码段DPL ≤ CPL
```

### 4. 分页相关

```
线性地址 = 目录索引(10位) | 页表索引(10位) | 页内偏移(12位)

快速计算：
目录索引 = 线性地址 >> 22
页表索引 = (线性地址 >> 12) & 0x3FF
页内偏移 = 线性地址 & 0xFFF
```

---

## 💡 学习建议

### ✅ 推荐学习方法

1. **先理解后记忆**
   - 不要死记硬背
   - 理解设计目的
   - 画图辅助理解

2. **动手实践**
   - 运行示例代码
   - 修改参数观察效果
   - 自己写代码验证

3. **对比学习**
   - 实模式 vs 保护模式
   - 段内转移 vs 段间转移
   - 中断门 vs 陷阱门

4. **重点突破**
   - 特权级机制（最重要）
   - 调用门和栈切换
   - 地址转换过程

### ⚠️ 常见误区

1. ❌ 只看不练
   - ✅ 必须动手写代码

2. ❌ 死记硬背
   - ✅ 理解原理和设计目的

3. ❌ 平均用力
   - ✅ 重点章节多花时间

4. ❌ 忽视细节
   - ✅ 注意字节顺序、位运算

---

## 📝 考前冲刺（考前1天）

### 快速复习清单

#### 上午（3小时）

- [ ] 复习02-特权级机制（1小时）
- [ ] 复习03-调用门与栈切换（1小时）
- [ ] 做计算题练习（1小时）

#### 下午（3小时）

- [ ] 复习07-实验代码详解（1小时）
- [ ] 看08-考点总结（1小时）
- [ ] 整理易错点（1小时）

#### 晚上（2小时）

- [ ] 背诵核心公式
- [ ] 看错题本
- [ ] 早点休息

---

## 🎯 考试当天

### 答题顺序建议

1. **先易后难**：先做会做的
2. **计算题**：写出步骤，即使答案错了也有步骤分
3. **简答题**：分点作答，条理清晰
4. **编程题**：加注释，说明思路
5. **检查**：留出10分钟检查

### 时间分配（假设120分钟）

| 题型 | 建议时间 |
|------|----------|
| 选择题 | 20分钟 |
| 填空题 | 15分钟 |
| 计算题 | 25分钟 |
| 简答题 | 30分钟 |
| 编程题 | 20分钟 |
| 检查 | 10分钟 |

---

## 📚 参考资料

### 课程参考书

1. 罗秋明. Linux技术内幕, 清华大学出版社, 2017
2. 于渊. Orange's: 一个操作系统的实现, 电子工业出版社, 2009
3. Robert Love. Linux内核设计与实现(3rd Edition), 机械工业出版社, 2011

### 在线资源

- Intel开发者手册：详细的处理器规范
- OSDev Wiki：操作系统开发资源
- Bochs调试器：虚拟机调试工具

---

## ✨ 最后的话

> 💪 **相信自己**：这些知识点看起来复杂，但理解了原理就不难
> 
> 📖 **重点突破**：特权级机制和调用门是核心，一定要掌握
> 
> 🔄 **多做练习**：计算题和编程题需要多练习
> 
> 😊 **保持心态**：考试时不要紧张，相信自己的准备

---

**祝你考试顺利！加油！** 🎓✨

---

## 📞 联系方式

如果有问题，可以：
- 📧 联系老师：xphu@swjtu.edu.cn
- 👥 和同学讨论
- 📖 查阅参考书

---

*最后更新：2025年11月*
