---
tags:
  - Knowledge/Computer-Network
created: 2025-12-15
author:
  - ln1
status: In Progress
---
## 1. 应用层概述
### 1.1 应用层的位置与功能
应用层是协议栈的最高层，直接为用户提供网络服务。

**核心功能：**
- 定义应用进程之间的通信规则
- 规定报文格式和交换方式

### 1.2 应用进程通信方式
#### (1) 客户/服务器（C/S）方式
- **服务器**：始终运行，等待请求，有固定IP和端口
- **客户端**：需要时运行，主动发起请求

> 类比：餐厅（服务器）等待顾客（客户端）点餐

#### (2) 浏览器/服务器（B/S）方式
- C/S的特例，客户端是浏览器
- 三层架构：表现层（浏览器）→ 处理层（Web服务器）→ 数据层（数据库）

#### (3) 对等（P2P）方式
- 每个节点既是客户端又是服务器
- 无中心服务器，节点直接通信
- 应用：文件共享、即时通讯

### 1.3 服务器工作方式
| 方式 | 特点 | 适用协议 |
|-----|------|---------|
| 循环方式 | 一次服务一个客户，顺序处理 | UDP |
| 并发方式 | 同时服务多个客户 | TCP |

> TCP服务器为每个客户创建一个子进程/线程


## 2. 域名系统（DNS）
### 2.1 DNS概述
**DNS（Domain Name System）**：将域名映射为IP地址的分布式数据库系统

```
用户输入：www.example.com
    ↓ DNS解析
得到IP：93.184.216.34
```

> DNS是互联网的"电话簿"，把好记的名字翻译成IP地址

### 2.2 域名结构
**层次树状结构**：`主机名.三级域名.二级域名.顶级域名`

例：`www.cs.tsinghua.edu.cn`
- cn：顶级域名（国家）
- edu：二级域名（教育机构）
- tsinghua：三级域名（清华大学）
- cs：四级域名（计算机系）
- www：主机名

#### 顶级域名分类
| 类型 | 说明 | 示例 |
|-----|------|------|
| 国家顶级域(ccTLD) | 国家/地区代码 | .cn .us .uk .jp |
| 通用顶级域(gTLD) | 通用类别 | .com .org .net .edu |
| 基础设施域 | 技术用途 | .arpa |

#### 常见通用顶级域名
| 域名 | 含义 |
|-----|------|
| .com | 商业公司 |
| .org | 非营利组织 |
| .net | 网络服务 |
| .edu | 教育机构（美国） |
| .gov | 政府部门（美国） |

### 2.3 域名服务器
**层次结构：**
```
根域名服务器（全球13套）
      ↓
顶级域名服务器（.com, .cn等）
      ↓
权威域名服务器（具体域名）
      ↓
本地域名服务器/递归解析器
```

| 服务器类型 | 功能 |
|-----------|------|
| 根服务器 | 知道所有顶级域名服务器的地址 |
| 顶级域名服务器 | 管理该顶级域下的二级域名 |
| 权威域名服务器 | 存储特定域的DNS记录 |
| 本地域名服务器 | 为用户提供DNS查询服务 |


### 2.4 DNS查询过程
#### 递归查询
- 本地服务器代替客户端完成全部查询
- 客户端只需等待最终结果

#### 迭代查询（常用）
```
1. 主机 → 本地DNS服务器："www.example.com的IP是？"
2. 本地DNS → 根服务器："www.example.com的IP是？"
3. 根服务器 → 本地DNS："去问.com服务器"
4. 本地DNS → .com服务器："www.example.com的IP是？"
5. .com服务器 → 本地DNS："去问example.com服务器"
6. 本地DNS → example.com服务器："www.example.com的IP是？"
7. example.com服务器 → 本地DNS："IP是93.184.216.34"
8. 本地DNS → 主机："IP是93.184.216.34"
```

> 主机到本地DNS通常是递归查询，本地DNS到其他服务器通常是迭代查询

### 2.5 DNS资源记录
| 类型 | 含义 | 示例 |
|-----|------|------|
| A | IPv4地址 | www.example.com → 93.184.216.34 |
| AAAA | IPv6地址 | www.example.com → 2606:2800:... |
| CNAME | 别名 | www → 实际主机名 |
| MX | 邮件服务器 | example.com → mail.example.com |
| NS | 域名服务器 | example.com → ns1.example.com |
| PTR | 反向解析 | IP → 域名 |

### 2.6 DNS缓存
- 域名服务器缓存查询结果，减少查询次数
- 缓存有TTL（生存时间），过期后需重新查询
- 提高查询效率，减轻根服务器负担

### 2.7 DNS协议
- 使用**UDP端口53**（查询）
- 使用**TCP端口53**（区域传送、大响应）


## 3. 电子邮件
### 3.1 电子邮件系统组成
```
发送方                                              接收方
┌──────┐    SMTP    ┌──────┐    SMTP    ┌──────┐   POP3/IMAP  ┌──────┐
│用户  │ ────────→ │邮件  │ ────────→ │邮件  │ ←────────── │用户  │
│代理  │           │服务器│           │服务器│              │代理  │
└──────┘           └──────┘           └──────┘              └──────┘
  Alice              发送方              接收方                Bob
```

**三个组成部分：**
1. **用户代理（UA）**：邮件客户端，如Outlook、Foxmail
2. **邮件服务器**：存储和转发邮件
3. **邮件协议**：SMTP、POP3、IMAP

### 3.2 邮件地址格式
```
用户名@域名
例：alice@example.com
```

### 3.3 SMTP协议
**SMTP（Simple Mail Transfer Protocol）**：用于发送邮件

| 特点 | 说明 |
|-----|------|
| 端口 | TCP 25 |
| 方向 | 推送（Push）协议 |
| 编码 | 7位ASCII |
| 连接 | 持久连接 |

**SMTP会话过程：**
```
S: 220 服务器就绪
C: HELO client.com
S: 250 Hello
C: MAIL FROM:<alice@example.com>
S: 250 OK
C: RCPT TO:<bob@example.com>
S: 250 OK
C: DATA
S: 354 开始输入邮件
C: Subject: Hello
C: 
C: This is a test.
C: .
S: 250 邮件已接受
C: QUIT
S: 221 再见
```

> SMTP只能传输7位ASCII，二进制数据需要MIME编码


### 3.4 邮件读取协议
#### POP3（Post Office Protocol 3）
| 特点 | 说明 |
|-----|------|
| 端口 | TCP 110 |
| 方向 | 拉取（Pull）协议 |
| 模式 | 下载并删除 / 下载并保留 |

**POP3三个阶段：**
1. 认证：USER + PASS
2. 事务处理：LIST、RETR、DELE
3. 更新：QUIT

#### IMAP（Internet Message Access Protocol）
| 特点 | 说明 |
|-----|------|
| 端口 | TCP 143 |
| 特点 | 邮件保留在服务器 |
| 功能 | 支持文件夹、搜索、部分下载 |

**POP3 vs IMAP：**

| 特性 | POP3 | IMAP |
|-----|------|------|
| 邮件存储 | 下载到本地 | 保留在服务器 |
| 多设备访问 | 不方便 | 方便 |
| 功能 | 简单 | 丰富 |
| 离线访问 | 支持 | 需要同步 |

#### Webmail
- 使用HTTP协议访问邮件
- 通过浏览器收发邮件
- 例：Gmail、QQ邮箱网页版

### 3.5 MIME扩展
**MIME（Multipurpose Internet Mail Extensions）**：扩展邮件格式，支持非ASCII内容

**MIME头部字段：**

| 字段 | 作用 |
|-----|------|
| Content-Type | 内容类型（text/html, image/jpeg等） |
| Content-Transfer-Encoding | 编码方式（base64, quoted-printable） |

> MIME让邮件可以包含图片、附件、HTML等多媒体内容


## 4. 万维网（WWW）
### 4.1 WWW概述
**WWW（World Wide Web）**：基于HTTP协议的分布式超媒体系统

**组成部分：**
- **Web客户端**：浏览器
- **Web服务器**：存储和提供Web资源
- **HTTP协议**：客户端和服务器之间的通信协议

### 4.2 URL（统一资源定位符）
```
协议://主机名:端口/路径/文件名?参数#锚点

例：https://www.example.com:443/path/page.html?id=1#section1
```

| 部分 | 说明 | 示例 |
|-----|------|------|
| 协议 | 访问方式 | http, https, ftp |
| 主机名 | 服务器地址 | www.example.com |
| 端口 | 服务端口（可省略） | 80, 443 |
| 路径 | 资源位置 | /path/page.html |

### 4.3 HTTP协议
**HTTP（HyperText Transfer Protocol）**：超文本传输协议

| 特点 | 说明 |
|-----|------|
| 端口 | TCP 80（HTTP）/ 443（HTTPS） |
| 模式 | 请求-响应模式 |
| 无状态 | 服务器不保存客户端状态 |

#### HTTP请求方法
| 方法 | 作用 |
|-----|------|
| GET | 获取资源 |
| POST | 提交数据 |
| PUT | 上传/更新资源 |
| DELETE | 删除资源 |
| HEAD | 获取响应头（不返回内容） |

#### HTTP请求报文格式
```
GET /index.html HTTP/1.1        ← 请求行
Host: www.example.com           ← 首部行
User-Agent: Mozilla/5.0
Accept: text/html
Connection: keep-alive
                                ← 空行
（请求体，GET通常没有）
```

#### HTTP响应报文格式
```
HTTP/1.1 200 OK                 ← 状态行
Content-Type: text/html         ← 首部行
Content-Length: 1234
Connection: keep-alive
                                ← 空行
<html>...</html>                ← 响应体
```


#### HTTP状态码（需要记忆）
| 状态码 | 类别 | 含义 |
|-------|------|------|
| 1xx | 信息 | 请求已接收，继续处理 |
| 2xx | 成功 | 请求成功 |
| 3xx | 重定向 | 需要进一步操作 |
| 4xx | 客户端错误 | 请求有误 |
| 5xx | 服务器错误 | 服务器处理出错 |

**常见状态码：**

| 状态码 | 含义 |
|-------|------|
| 200 OK | 请求成功 |
| 301 Moved Permanently | 永久重定向 |
| 302 Found | 临时重定向 |
| 304 Not Modified | 资源未修改（使用缓存） |
| 400 Bad Request | 请求语法错误 |
| 401 Unauthorized | 需要认证 |
| 403 Forbidden | 禁止访问 |
| 404 Not Found | 资源不存在 |
| 500 Internal Server Error | 服务器内部错误 |
| 503 Service Unavailable | 服务不可用 |

### 4.4 HTTP版本演进
| 版本 | 特点 |
|-----|------|
| HTTP/1.0 | 非持久连接，每个请求一个TCP连接 |
| HTTP/1.1 | 持久连接，管道化，默认keep-alive |
| HTTP/2 | 二进制分帧，多路复用，头部压缩 |
| HTTP/3 | 基于QUIC（UDP），更快的连接建立 |

> HTTP/1.1的持久连接：一个TCP连接可以传输多个请求/响应

### 4.5 Cookie与Session
**Cookie**：服务器发送给浏览器的小数据，浏览器保存并在后续请求中携带

**用途：**
- 用户身份识别
- 购物车
- 用户偏好设置

**Session**：服务器端保存的用户状态信息
- 通过Cookie中的Session ID关联

> Cookie存在客户端，Session存在服务器端


## 5. 其他应用层协议
### 5.1 FTP（文件传输协议）
| 特点 | 说明 |
|-----|------|
| 端口 | TCP 21（控制）/ 20（数据） |
| 连接 | 双连接：控制连接 + 数据连接 |
| 模式 | 主动模式 / 被动模式 |

**FTP工作模式：**
- **主动模式**：服务器主动连接客户端的数据端口
- **被动模式**：客户端主动连接服务器的数据端口（穿越防火墙）

### 5.2 Telnet（远程登录）
| 特点 | 说明 |
|-----|------|
| 端口 | TCP 23 |
| 安全性 | 明文传输，不安全 |
| 替代 | SSH（端口22） |

### 5.3 SNMP（简单网络管理协议）
| 特点 | 说明 |
|-----|------|
| 端口 | UDP 161（代理）/ 162（管理站） |
| 用途 | 网络设备监控和管理 |

### 5.4 DHCP（动态主机配置协议）
| 特点 | 说明 |
|-----|------|
| 端口 | UDP 67（服务器）/ 68（客户端） |
| 用途 | 自动分配IP地址 |

> DHCP在网络层笔记中有详细介绍

## 6. 内容分发
### 6.1 CDN（内容分发网络）
**CDN**：将内容缓存到离用户更近的边缘服务器

**优点：**
- 减少延迟
- 减轻源服务器负担
- 提高可用性

### 6.2 P2P网络
**特点：**
- 无中心服务器
- 节点既是客户端又是服务器
- 可扩展性好

**应用：**
- 文件共享（BitTorrent）
- 即时通讯
- 流媒体


## 7. 重点概念速记

### 应用层协议端口号（必背）
| 协议 | 端口 | 传输层 |
|-----|------|--------|
| FTP数据 | 20 | TCP |
| FTP控制 | 21 | TCP |
| SSH | 22 | TCP |
| Telnet | 23 | TCP |
| SMTP | 25 | TCP |
| DNS | 53 | UDP/TCP |
| DHCP服务器 | 67 | UDP |
| DHCP客户端 | 68 | UDP |
| HTTP | 80 | TCP |
| POP3 | 110 | TCP |
| IMAP | 143 | TCP |
| SNMP | 161 | UDP |
| HTTPS | 443 | TCP |

### 协议对比
```
┌─────────────────────────────────────────────────────┐
│  邮件协议对比                                        │
├─────────────────────────────────────────────────────┤
│  SMTP:  发送邮件 | 推送 | TCP 25                    │
│  POP3:  接收邮件 | 拉取 | TCP 110 | 下载到本地      │
│  IMAP:  接收邮件 | 拉取 | TCP 143 | 保留在服务器    │
└─────────────────────────────────────────────────────┘
```

### DNS查询类型
| 查询类型 | 特点 |
|---------|------|
| 递归查询 | 服务器代为完成全部查询 |
| 迭代查询 | 服务器返回下一步查询地址 |

### HTTP关键概念
| 概念 | 说明 |
|-----|------|
| 无状态 | 服务器不记录客户端状态 |
| 持久连接 | 一个TCP连接传输多个请求 |
| Cookie | 客户端存储的状态信息 |
| Session | 服务器端存储的状态信息 |

### 易混淆概念
| 概念A | 概念B | 区别 |
|------|------|------|
| SMTP | POP3/IMAP | SMTP发送，POP3/IMAP接收 |
| POP3 | IMAP | POP3下载到本地，IMAP保留在服务器 |
| HTTP | HTTPS | HTTPS加密传输 |
| Cookie | Session | Cookie在客户端，Session在服务器 |
| 递归查询 | 迭代查询 | 递归代为查询，迭代返回地址 |

---
> 💡 学习建议：
> 1. 重点掌握DNS的工作原理和查询过程
> 2. 理解邮件系统的三个组成部分和协议分工
> 3. 熟悉HTTP请求/响应格式和常见状态码
> 4. 记住常用端口号
> 5. 理解各协议的应用场景
