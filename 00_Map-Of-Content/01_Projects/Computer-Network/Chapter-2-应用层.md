---
tags:
  - Knowledge/Computer-Network
created: 2025-09-23
author:
  - ln1
status: In Progress
---
## 1.网络应用原理
将应用软件限制在端系统的方法，促进了大量的网络应用程序的迅速研发和部署。
### 1.1.网络应用体系结构
**应用体系结构**（application architecture）规定了如何在各种端系统上组织应用程序。
#### 客户-服务器体系结构(client-server architecture)：
- 有一个总是打开的**主机**，称为**服务器**，它服务于来自许多其他称为**客户**的主机的请求。
- 托管大量主机的**数据中心**(data center)被用于创建强大的虚拟服务器。
![[Pasted image 20250923211120.png]]
#### P2P体系结构(P2P architecture)：
- 对位于数据中心的专用服务器有最小的（或者没有）依赖。
- 应用程序在间接连接的主机对之间使用直接通信，这些主机对称为对等方。
- 具有自扩展性(self-scalability)。
![[Pasted image 20250923211136.png]]
### 1.2.进程通信
从操作系统的术语来说，进行通信的实际上是**进程(process)**。
#### 1.客户和服务器进程：
- 通常将两个进程之一标识为**客户**(client)，另一个进程标识为**服务器**(server)。
- 在一对进程之间的通信会话场景中，发起通信（即在该会话开始时发起与其他进程的联系）的进程被标识为**客户**，在会话开始时等待联系的进程是**服务器**。
#### 2.进程与计算机网络之间的接口：
进程通过**套接字**（socket）的软件接口向网络发送报文和从网络接收报文。它是同一台主机内应用层与运输层之间的接口，也被称为**应用编程接口(Application Programming Interface API)**。
![[Pasted image 20250923211317.png]]
#### 3.进程寻址：
根据两种信息进行寻址：
1. 主机的地址：在因特网中，主机由其**IP地址**(IP address)标识。
2. 在目的主机中指定接收进程的标识符：目的地**端口号**(port number)。
### 1.3.可供应用程序使用的运输服务
#### 1.可靠数据传输：
**可靠数据传输**(reliable data transfer)：一个协议提供了保证数据交付的服务。
- 如果一个运输层协议不提供可靠数据传输，那么可能被能够**容忍丢失的应用**(loss-tolerant application)所接受。
#### 2.吞吐量：
- 具有吞吐量要求的应用程序被称为**带宽敏感的应用(bandwidth-sensitive application)**。
- **弹性应用**(elastic application)能够根据当时可用的带宽或多或少地利用可供使用的吞吐量。
#### 3.定时

#### 4.安全性

### 1.4.因特网提供的运输服务
#### 1.TCP服务：
包括**面向连接服务**和**可靠数据传输服务**。
- 面向连接的服务：全双工([[物理层#单工、半双工和全双工]])，连接双方的进程可以在此连接上同时进行报文收发。
- 可靠的数据传输服务：通信进程能够依靠TCP，无差错、按适当顺序交付所有发送的数据。
- TCP还有拥塞控制机制，这种服务不一定能为通信进程带来直接好处，但能为因特网带来整体好处。
> 无论TCP还是UDP都没有提供任何加密机制，因特网界研制了运输层安全(Transport Layer Security TLS)。但这种强化是在应用层上实现的。
#### 2.UDP服务：
UDP是一种**不提供不必要**的轻量级运输协议。
#### 3.因特网运输协议所不提供的服务：
![[Pasted image 20250923215411.png]]
### 1.5.应用层协议：
应用层协议(application-layer protocol)，应用层协议只是网络应用的一部分。

## 2.Web和HTTP
### 2.1.HTTP概述
- **超文本传输协议(HyperText Transfer Protocol HTTP)**，是Web的核心。
- **Web界面**(Web page)是由对象组成的。一个**对象**(object)只是一个文件。
- **Web 浏览器(Web browse)**  实现了HTTP的客户端，**Web 服务器(Web Server)** 实现了HTTP的服务器端。
- HTTP定义了Web客户向Web服务器请求Web页面的方式，以及服务器向客户传送Web页面的方式。
- HTTP使用TCP作为它的支撑运输协议。HTTP不用担心数据丢失，也不关注TCP从网络的数据丢失和乱序故障中恢复的细节。
- HTTP是一个**无状态协议(stateless protocol)** ：服务器向客户发送被请求的文件，而不存储任何关于该客户的状态信息。
### 2.2.非持续连接和持续连接
**往返时间(Round-Trip Time RTT)**：一个短分组从客户到服务器然后再返回客户所花费的时间。
TCP连接的“**三次握手**”：即客户向服务器发送一个小TCP报文段，服务器用一个小TCP报文段做出确认和响应，最后，客户向服务器返回确认。
![[Pasted image 20250923221709.png]]
#### 1. HTTP 非持续连接（Non-Persistent Connection）

- 定义：  
    在 **HTTP/1.0 默认**使用的通信方式中，每一次请求-响应（Request-Response）交换都要建立一个新的 TCP 连接，请求完成后立即关闭连接。
- 特点：
    - 每获取一个资源（如一个 HTML 页面里的图片、CSS、JS 等），都要重新建立 TCP 连接。
    - TCP 的三次握手和四次挥手会带来额外的开销。
    - 并发下载多个资源时，浏览器通常会开启多个并行连接（例如 6 个）。

---

#### 2. HTTP 持续连接（Persistent Connection）

- 定义：  
    在 **HTTP/1.1 默认**使用的通信方式中，多个请求-响应可以复用同一个 TCP 连接，在一段时间内保持连接不断开。
- 特点：
    - 避免了频繁建立和关闭 TCP 连接的开销。
    - 支持在一个连接上顺序或流水线方式发送多个请求。
    - 提高传输效率，降低延迟，尤其适合加载包含大量小资源的网页。
#### 3.HTTP报文格式
##### 1.HTTP请求报文
![[Pasted image 20251125113631.png]]
##### 2.HTTP响应报文
![[Pasted image 20251125113734.png]]
#### 4.用户与服务器的交互：cookie
![[Pasted image 20251125114727.png]]

#### 5.Web缓存
Web缓存器(Web cache)也叫**代理服务器(proxy server)**：能够代表初始Web服务器来满足HTTP请求的网络实体。
- Web缓存器有自己的磁盘存储空间，并在存储空间中保存最近请求过的对象的副本。
- 既是服务器又是客户
![[Pasted image 20251209101341.png]]

**为什么要用Web缓存？**
1. 大大减少对客户请求的响应时间
2. 大大减少一个机构的接入链路到因特网的通信量
3. 从整体上大大降低因特网上的Web流量

##### 内容分发网络(CDN)
**CDN(Content Distribution Network)**：CDN公司在因特网上安装了许多地理上分散的缓存器，使大量流量实现了本地化。

##### 条件GET方法
**条件GET(conditional GET)**：HTTP协议的一种机制，允许缓存器证实它的对象是最新的。
- 请求报文使用GET方法
- 请求报文包含一个 `If-Modified-Since:` 首部行：缓存器向服务器发送，如果自接受时间以来被修改过了，则发送，否则不发送。

#### 6.HTTP/2
**HTTP/1.1的问题**：**队首阻塞(Head of Line, HOL blocking)**
- 持续连接中，如果前面有一个大对象，后面的小对象必须等待

**HTTP/2的主要改进**：
1. **成帧(framing)**：将报文分解成独立的帧，交错发送，在接收端重新组装
2. **响应报文优先级**：客户可以指定请求的优先级，为每个报文分配1-256之间的权重，较大的数字表明较高的优先权。
3. **服务器推送(server push)**：服务器可以主动额外推送客户端可能需要的对象。
4. **压缩首部**：减少开销

**HTTP/3**：基于**UDP**上的**QUIC**协议，进一步减少时延

### 2.3.电子邮件
因特网电子邮件系统的三个主要组成部分：
1. **用户代理(user agent)**
2. **邮件服务器(mail server)**
3. **简单邮件传输协议(SMTP)**
![[Pasted image 20251209103016.png]]
#### 1.SMTP
- 使用**TCP**进行可靠传输，端口号**25**
- 是一个**推协议(push protocol)**：发送邮件服务器把文件推向接收邮件服务器
- SMTP要求报文体采用**7位ASCII**格式：　在用SMTP传送邮件之前，需要将二进制多媒体数据编码为ASCII码，并且在使用SMTP传输后要求将相应的ASCII码邮件解码还原多媒体数据。 
![[Pasted image 20251209103408.png]]

**SMTP与HTTP对比**：

| 特性    | HTTP         | SMTP        |
| ----- | ------------ | ----------- |
| 传输方向  | 拉协议          | 推协议         |
| 报文格式  | 无限制          | 7位ASCII     |
| 多对象处理 | 每个对象封装在响应报文中 | 所有对象放在一个报文中 |

#### 2.邮件报文格式
首部行（必须包含`From:`和`To:`）+ 空行 + 报文体

#### 3.邮件访问协议
> 📝 **笔记**：SMTP是推协议，用于发送；获取邮件需要拉协议

- **POP3**：第三版的邮局协议，端口110
- **IMAP**：因特网邮件访问协议，端口143，功能更强
- **基于Web的电子邮件**：HTTP
![[Pasted image 20251209110254.png]]
### 2.4.DNS：因特网的目录服务
#### 1.DNS提供的服务
**域名系统(Domain Name System DNS)**：
1. 一个由分层的**DNS服务器**实现的分布式数据库
2. 一个使得主机能够查询分布式数据库的**应用层协议**

DNS运行在**UDP**之上，使用**53**号端口

**DNS提供的服务**：
- **主机名到IP地址的转换**（主要服务）
- **主机别名(host aliasing)**
- **邮件服务器别名(mail server aliasing)**
- **负载分配(load distribution)**

#### 2.DNS工作机理概述
只使用一个DNS服务器集中管理会带来一系列的问题：
- 单点故障(single point of failure)：如果该DNS服务器崩溃，整个因特网随之瘫痪。
- 通信容量(traffic volume)
- 远距离的集中式数据库(distant centralized database)
- 维护(maintenance)
##### 分布式、层次数据库

三类DNS服务器：
1. **根DNS服务器**：超过1000台复制全球13个不同根服务器的根服务器副本（标号A到M）
2. **顶级域(TLD)DNS服务器**：如com、org、net、edu、gov等
3. **权威DNS服务器**：组织机构自己的DNS服务器
![[Pasted image 20251209111654.png]]
**本地DNS服务器(local DNS server)**：不严格属于层次结构，但很重要。
![[Pasted image 20251209112306.png]]
##### DNS查询方式
- **递归查询(recursive query)**
![[Pasted image 20251209113417.png]]
- **迭代查询(iterative query)**
查询通常遵循图2-18中的模式：从请求主机到本地DNS服务器的查询是递归的，其余的查询是迭代的。
##### DNS缓存
DNS服务器在收到DNS回答后，能将映射缓存在本地存储器中。通常2天后丢弃。

#### 3.DNS记录和报文
**资源记录(Resource Record RR)**：格式为`(Name, Value, Type, TTL)`

| Type | Name | Value |
|------|------|-------|
| A | 主机名 | IP地址 |
| NS | 域 | 权威DNS服务器主机名 |
| CNAME | 别名 | 规范主机名 |
| MX | 别名 | 邮件服务器规范主机名 |
![[Pasted image 20251209114934.png]]
标识位指出查询报文(0)还是回答报文(1)
> DNS只有查询和回答报文。DNS只有这两种报文，并且查询和回答报文有着相同的格式。
### 2.5.P2P文件分发
#### BitTorrent
- **洪流(torrent)**：参与一个特定文件分发的所有对等方的集合
- **追踪器(tracker)**：每个洪流具有的基础设施节点
- **文件块(chunk)**：文件被分成等长的块，典型大小256KB

**关键机制**：
- **最稀缺优先(rarest first)**：优先请求副本数量最少的块
- **疏通(unchoke)**：根据上传速率选择对等方进行交换

### 2.6.视频流和内容分发网
#### 1.因特网视频
- 视频是一系列图像，以恒定速率（如每秒24或30幅图像）展现
- 可以被压缩，用**比特率(bit per second)**衡量质量
- 压缩方式：空间冗余、时间冗余

#### 2.HTTP流和DASH
**经HTTP的动态自适应流(DASH)**：
- 视频编码为几个不同的版本，每个版本有不同的比特率和质量等级
- 客户动态请求不同版本的视频段
- **告示文件(manifest file)**：提供不同版本的URL

> 📝 **核心思想**：客户端根据可用带宽自适应选择视频质量

#### 3.内容分发网(CDN)
**CDN管理分布在多个地理位置上的服务器**，在服务器中存储视频副本。

两种服务器安置策略：
1. **深入(Enter Deep)**：部署在接入ISP中，靠近用户
2. **邀请做客(Bring Home)**：部署在少量关键位置（如IXP）

### 2.7.套接字编程

#### 1.UDP套接字编程
- **无连接**：发送前不需要握手
- 发送方显式附上目的IP地址和端口号
- 接收方从分组中提取发送方地址

**关键函数**：
```python
# 创建UDP套接字
clientSocket = socket(AF_INET, SOCK_DGRAM)
# 发送
clientSocket.sendto(message, (serverName, serverPort))
# 接收
message, serverAddress = clientSocket.recvfrom(2048)
```

#### 2.TCP套接字编程
- **面向连接**：需要先建立TCP连接
- 服务器有**欢迎套接字**和**连接套接字**

**关键函数**：
```python
# 服务器
serverSocket = socket(AF_INET, SOCK_STREAM)
serverSocket.bind(('', serverPort))
serverSocket.listen(1)
connectionSocket, addr = serverSocket.accept()

# 客户端
clientSocket = socket(AF_INET, SOCK_STREAM)
clientSocket.connect((serverName, serverPort))
```

**TCP vs UDP套接字编程对比**：
| 特性 | UDP | TCP |
|------|-----|-----|
| 套接字类型 | SOCK_DGRAM | SOCK_STREAM |
| 建立连接 | 不需要 | 需要connect/accept |
| 发送方式 | sendto(需指定地址) | send |
| 接收方式 | recvfrom | recv |

---
## 📚 本章核心概念速览

| 概念 | 一句话解释 |
|------|-----------|
| 客户-服务器 vs P2P | 有没有中心服务器的区别 |
| 套接字 | 应用层和传输层之间的接口 |
| HTTP | Web的核心协议，基于TCP，无状态 |
| 持续连接 | HTTP/1.1默认，复用TCP连接 |
| Cookie | HTTP保持用户状态的机制 |
| Web缓存 | 代理服务器，减少延迟和带宽 |
| DNS | 域名→IP地址，分布式数据库 |
| CDN | 内容分发网络，就近获取 |
| DASH | 自适应视频流，根据带宽选质量 |

---
## ✅ 复习检查清单
- [ ] 能说出HTTP请求报文的格式
- [ ] 理解持续连接和非持续连接的区别
- [ ] 知道DNS的三层架构
- [ ] 理解递归查询和迭代查询
- [ ] 能解释CDN的工作原理
- [ ] 了解UDP和TCP套接字编程的区别
