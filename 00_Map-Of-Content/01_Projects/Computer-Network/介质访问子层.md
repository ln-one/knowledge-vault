---
tags:
  - Knowledge/Computer-Network
created: 2025-10-28
author:
  - ln1
status: In Progress
---
![[Pasted image 20251028095330.png]]
## 1.信道分配问题：

### MAC子层位置
- **数据链路层分为两个子层**：
  - MAC子层：介质访问控制（Medium Access Control）
  - LLC子层：逻辑链路控制（承上启下，弱层）

> MAC子层处理"谁能发送"的问题，LLC子层处理"如何发送"的问题

### 信道类型
- **点到点信道**：信道直接连接两个端点
  - 例：家中计算机通过modem连接到电信公司端局
- **多点访问信道**：多用户共享一根信道（广播信道、随机访问信道）
  - 例：以太网的典型拓扑

### 常见的局域网拓扑
- **总线拓扑**、**星型拓扑**、**环型拓扑**
- **共同点**：共享一根信道
- **核心问题**：某时由谁来访问共享信道？

> 早期以太网是总线拓扑，现在多为星型拓扑但逻辑上仍是总线（使用集线器时）

### 静态分配 vs 动态分配
#### 静态分配（TDM、FDM）
- **特点**：资源分配固定，延迟时间增大N倍
- **适用**：用户数量少且固定，通信量大且流量稳定
- **缺点**：资源浪费，效率低，不适用于突发性业务

#### 动态分配
- **目的**：更好地满足需求，提高信道利用率



## 2.多路访问协议

### 2.1 随机访问协议

#### ALOHA协议
##### 纯ALOHA协议
- **工作原理**：想发就发！（任性）
- **特点**：冲突不可避免，随时可能冲突，冲突的帧完全破坏
- **冲突危险期**：2D（D为单向传播延迟）
- **吞吐量**：S = Ge^(-2G)，最大吞吐率约18.4%（G=0.5时）

> 冲突危险期为2D是因为：A发送时，最远的B在D时间后才能检测到，如果B在A发送后D时间内发送，会在A处产生冲突

##### 分隙ALOHA协议
- **改进**：把时间分成时隙，帧的发送必须在时隙的起点
- **冲突危险期**：D（减半）
- **吞吐量**：S = Ge^(-G)，最大吞吐率约36.8%（G=1时）
- **优势**：是纯ALOHA的两倍

> 时隙同步使得冲突只能发生在时隙开始时刻，大大减少了冲突概率

#### CSMA协议（载波侦听多路访问）
- **核心思想**："先听后发"（不再任性，变得礼貌）

##### 非持续式CSMA
- **特点**：介质空闲则发送，介质忙则等待随机时间
- **优点**：减少再次碰撞可能性
- **缺点**：等待时间内介质空闲是浪费

##### 1-持续式CSMA
- **特点**：介质空闲立即发送，介质忙持续侦听
- **优点**：延迟时间少
- **缺点**：多个站等待时一定会发生冲突

##### p-持续式CSMA
- **特点**：介质空闲时以概率p发送，以(1-p)概率延迟
- **注意**：1-持续式是p-持续式的特例

#### CSMA/CD协议
- **全称**：Carrier Sense Multiple Access with Collision Detection
- **原理**："先听后发、边发边听"
- **冲突窗口**：2D（发送站发出帧后能检测到冲突的最长时间）
- **要求**：发送帧的时间不能太短，至少一个冲突窗口的时间
- **Jam信号**：一旦检测到冲突，发送强化信号

> CSMA/CD是以太网的核心协议，"边发边听"是关键，这要求全双工通信能力

### 2.2 受控访问协议（无冲突）

#### 位图协议（预留协议）
- **过程**：竞争期举手示意 → 传输期按序发送
- **信道利用率**：低负荷d/(d+N)，高负荷d/(d+1)

> 类似会议发言，先举手报名，再按顺序发言，避免了冲突但增加了开销

#### 令牌传递
- **原理**：令牌=发送权限，获得令牌才能发送
- **缺点**：令牌的维护代价

> 令牌环网络的经典协议，令牌丢失或重复都会导致网络故障

#### 二进制倒计数协议
- **特点**：高序号站点优先获得发送权
- **信道利用率**：d/(d+log₂N)

### 2.3 有限竞争协议
- **代表**：自适应树搜索协议
- **思想**：结合随机访问和受控访问的优势

## 3.以太网：
### 3.1 经典以太网

#### 物理层特征
- **最高速率**：10Mbps
- **编码方式**：曼彻斯特编码
- **连接方式**：同轴电缆和中继器
- **5-4-3-2-1原则**：任意两个收发器间距离≤2.5km，中继器≤4个

#### MAC帧格式
**两种标准**：
- **DIX Ethernet V2**（最常用）：类型字段表示上层协议
- **IEEE 802.3**：长度字段表示数据长度

**帧结构**：前导码(8) + 目的地址(6) + 源地址(6) + 类型/长度(2) + 数据(46~1500) + 校验和(4)

#### 帧长度要求
- **最小帧长**：64B（46+18，不足需填充Padding）
- **最大帧长**：1518B（1500+18，MTU=1500B）
- **64B的意义**：确保在冲突检测期间内能发送完整帧
- **无效帧判断**：
  - 长度不在46~1500字节
  - 帧长度不是整数字节
  - FCS校验错误
  - 数据字段长度与长度字段值不一致

> 64B最小帧长保证了在最坏情况下（2500米网络）能在冲突窗口内检测到冲突

#### MAC地址
- **长度**：6字节（48位）
- **组成**：OUI(3字节) + 厂商分配(3字节)
- **类型**：
  - 单播：正常MAC地址
  - 广播：FF-FF-FF-FF-FF-FF
  - 组播：第一字节最低位为1

#### CSMA/CD工作机制
- **二进制指数后退算法**：
  - 基本退避时间槽：512比特时间（2τ）
  - 重传次数k = min[重传次数, 10]
  - 随机数r从[0, 2^k-1]中选择
  - 重传延迟 = r × 2τ
  - 重传16次仍失败则丢弃

> 退避算法能自适应网络负载：冲突多时退避时间长，冲突少时退避时间短

#### 性能分析
- **信道效率** = 1/(1 + 2BLe/cF)
- P=F/B（F为帧长，B为带宽）
- L为电缆长度，c为信号传播速度
- **影响因素**：电缆越长、带宽越高，效率越低
### 3.2 交换式以太网

#### 集线器 vs 交换机
**集线器（HUB）**：
- 工作在**物理层**，所有端口内部连通
- 逻辑上等同于单根总线
- 所有站都在**同一个冲突域**，必须使用CSMA/CD
- 不能增加容量，限制网络可扩展性

**交换机（Switch）**：
- 工作在**数据链路层**，检查MAC帧目的地址进行转发
- 通过高速背板连接所有端口
- **每个端口独立的冲突域**
- 全双工模式下不需要CSMA/CD，可实现并行传输
- **混杂模式**：可用于网络分析和黑客攻击

> 交换机的出现是以太网发展的重要里程碑，从共享介质变为交换介质

![[Pasted image 20251028101322.png]]
![[Pasted image 20251028101834.png]]
### 3.3 以太网发展历程

#### 快速以太网（Fast Ethernet, IEEE 802.3u, 1995）
- **速率**：100Mbps（10倍提升）
- **保持兼容**：帧格式、接口、过程规则不变
- **新特性**：自动协商（autonegotiation）
- **主要标准**：
  - 100Base-TX：5类UTP，100米，全双工
  - 100Base-FX：光纤，2000米
  - 100Base-T4：3类UTP，100米

#### 千兆以太网（Gigabit Ethernet, IEEE 802.3ab, 1998）
- **速率**：1000Mbps（1Gbps）
- **工作方式**：全双工（缺省）和半双工
- **半双工改进**：载波扩充和帧突发（保证CSMA/CD工作）
- **新特性**：流量控制和巨型帧（Jumbo frame）
- **主要标准**：
  - 1000Base-T：5类UTP，100米
  - 1000Base-SX：多模光纤，550米
  - 1000Base-LX：单模光纤，5000米

#### 万兆以太网（10-Gigabit Ethernet, IEEE 802.3ae, 2002）
- **速率**：10Gbps
- **重要变化**：**只支持全双工**，不再使用CSMA/CD
- **编码**：64b/66b（提高效率）
- **重点**：超高速的物理层技术

#### 40G/100G以太网（IEEE 802.3ba, 2010）
- **速率**：40Gbps & 100Gbps
- **技术**：4×10G lanes（40G）、10×10G lanes（100G）
- **特点**：只支持全双工，保留以太网帧格式

#### 以太网的未来
- **25/50G以太网**：弥补10G低带宽和40G高成本缺陷
- **200G/400G以太网**：2017年标准获得批准
- **800G/1.6T以太网**：2020-2030年预期标准
- **成功原因**：不断增长的以太网生态系统，开放标准
## 4.数据链路层交换

### 核心概念
- **冲突域**：发生冲突的范围
- **广播域**：广播帧能够到达的范围
### 4.1.数据链路层交换原理
#### 物理层设计扩充网络
- 扩大了冲突域，性能降低，安全隐患
#### 数据链路层设备扩充网络：
- 网桥或交换机
- 分隔了冲突域
理想的网桥是**透明**的：
- 即插即用，无需任何配置
- 网络中的站点**无需感知**网桥的存在与否。
#### MAC地址表的构建
- 逆向学习**源地址**；
- 设定**老化时间**（默认300S），当老化时间到期时，该表项会被清除。
• 增加表项：帧的源地址对应的项不在表中
• 删除表项：老化时间到期
• 更新表项：帧的源地址在表中，更新时间戳

> 逆向学习是透明网桥的核心机制，通过观察帧的源地址来学习网络拓扑
![[Pasted image 20251028105938.png]]
![[Pasted image 20251028110004.png]]
![[Pasted image 20251028110036.png]]
#### 网桥转发行为
**Flooding（泛洪）**
两种目的地址的帧，需要泛洪：
• 广播帧：目的地址为**FF-FF-FF-FF-FF-FF**的数据帧
• 未知单播帧：**目的地址不在MAC地址转发表**中的单播数据帧

> 泛洪是必要的恶：保证连通性但浪费带宽，这就是为什么要尽快学习MAC地址
### 4.2.链路层交换机
- 多端口透明网桥，网桥的现代名称。
- 一种即插即用设备
![[Pasted image 20251028110756.png]]
![[Pasted image 20251028110805.png]]
#### 交换方式：
- 对称交换
- 非对称交换
#### 交换模式：从转发时机角度：
##### 1.存储转发模式（Store and Forward)
- 特点：转发前必须接收**整个帧**，执行CRC校验
- 缺点：延迟大
- 优点：不转发出错帧、支持非对称交换

> 最安全的转发方式，现代交换机的主流模式
##### 2.直通交换（Cut-through）
- 特点：一旦接收到**帧的目的地址**，就开始转发
- 缺点：可能转发错误帧，不支持非对称交换
- 优点：延迟小，可以边入边出

> 追求极低延迟的应用场景使用，如高频交易系统
##### 3.无碎片交换（Fragment-free）
- 特点：接收到**帧的前64字节**，即开始转发
- 缺点：仍可能转发错误帧，不支持非对称交换。
- 优点：过滤了冲突碎片，延迟中等

> 折中方案：64字节能过滤掉大部分冲突产生的碎片帧


### 4.3 生成树协议（STP）

#### 物理环路的问题
1. **广播风暴**：广播帧无限循环，消耗网络资源
2. **重复帧**：目的设备收到重复的帧副本
3. **MAC地址表不稳定**：同一MAC地址对应端口不断变化

#### STP工作原理
- **发明人**：Radia Perlman（1983年）
- **目标**：打破物理环，维护逻辑无环树
- **关键信息**：BPDU（桥协议数据单元）包含：
  - 根桥ID（Root ID）
  - 根路径开销（Root Path Cost）
  - 指定桥ID（Designated Bridge ID）
  - 指定端口ID（Designated Port ID）

> STP的核心思想：在有冗余链路的网络中构建一棵无环的生成树

#### 三个选举过程
1. **选举根桥**：桥ID最小的成为根桥（优先级+MAC地址）![[Pasted image 20251104113423.png]]
2. **选举根端口**：每个非根桥选出到根桥开销最小(**开销相同**则选择**端口ID最小**)的端口
![[Pasted image 20251104114143.png]]什么是根路径开销？
	• 根桥的根路径开销为0；
	• 非根桥的根路径开销为到根桥的路径上所有端口（链路）开销之和。
	• 端口（链路）开销值由IEEE定义（如下表），也可通过手工配置改变。
3. **选举指定端口**：每个网段选出根路径开销最小(相同则选id小)的端口![[Pasted image 20251104114612.png]]
> 选举顺序很重要：先选根桥，再选根端口，最后选指定端口

#### 端口状态
- **Forwarding**：转发状态（指定端口、根端口）
- **Blocking**：阻塞状态（非指定非根端口）
- **Listening/Learning**：过渡状态（各15秒）

#### RSTP改进
- **快速收敛**：几百毫秒（vs STP的30秒）
- **边缘端口**：直连终端设备，可直接进入转发状态

### 4.4 虚拟局域网（VLAN）

#### VLAN基本概念
- **定义**：在物理网络上根据用途、工作组逻辑划分的局域网
- **目的**：分隔广播域，提高安全性和可管理性
- **特点**：与用户物理位置无关

> VLAN实现了"一个物理网络，多个逻辑网络"的概念

#### VLAN类型
1. **基于端口的VLAN**（最常见）：指定成员端口
2. **基于MAC地址的VLAN**：MAC地址决定成员身份
3. **基于协议的VLAN**：按协议类型划分（IP、IPX等）
4. **基于子网的VLAN**：一个子网就是一个VLAN

#### IEEE 802.1Q标准
- **标记帧**：携带VLAN标记的帧（4字节VLAN标记）
- **无标记帧**：普通以太网帧
- **VLAN标记结构**：
  - 标记协议标识符（2字节）
  - 标记控制信息（2字节）：优先级(3bit) + CFI(1bit) + VLAN ID(12bit)

#### 端口类型
- **Access端口**：连接用户设备，只能加入一个VLAN
- **Trunk端口**：连接交换机，允许多个VLAN流量通过

> Access端口面向用户，Trunk端口面向网络设备

#### VLAN优点
- 有效控制广播域范围
- 增强网络安全性（VLAN间隔离）
- 灵活构建虚拟工作组
- 提高网络可管理性

## 5.无线局域网（WLAN）

### 5.1 基本概念
- **定义**：以无线信道作为传输介质的计算机局域网
- **设计目标**：
  - 小覆盖范围（受限发射功率）
  - 使用无需授权的频谱（ISM频段）
  - 面向高速率应用
  - 支持实时和非实时应用

### 5.2 组网模式

#### 基础架构模式
- **分布式系统（DS）**：连接多个AP的骨干网络
- **访问点（AP）**：无线接入点
- **站点（STA）**：无线终端设备
- **基本服务集（BSS）**：一个AP管理的区域
- **扩展服务集（ESS）**：多个BSS组成的网络
- **通信方式**：站点间通信通过AP转发

#### 自组织模式（Ad hoc）
- **独立基本服务集（IBSS）**：无AP的对等网络
- **通信方式**：站点间直接通信
- **特点**：共享同一无线信道

### 5.3 IEEE 802.11体系结构
- **物理介质相关子层（PMD）**：调制解调、编码/解码
- **物理层汇聚协议（PLCP）**：提供独立于传输技术的接口
- **介质访问控制层（MAC）**：可靠数据传输、介质访问控制、安全机制

### 5.4 物理层技术
- **频段**：2.4GHz、5GHz（ISM频段，无需授权，功率≤1瓦）
- **调制技术演进**：DPSK → QPSK → CCK → 64-QAM → 256-QAM → 1024-QAM
- **技术演进**：DSSS → OFDM → OFDMA
- **天线技术**：单天线 → SU-MIMO → MU-MIMO

### 5.5 CSMA/CA协议

#### 无线环境的挑战
- **冲突检测困难**：发送功率和接收功率相差太大
- **隐藏终端问题**：载波侦听失败，但在接收端发生冲突
- **暴露终端问题**：误以为信道忙而不能发送，降低吞吐量

> 无线环境比有线环境复杂得多：信号衰减、多径传播、移动性等都是挑战

#### CSMA/CA工作机制
- **核心思想**：Collision Avoidance（冲突避免）
- **工作流程**：
  1. 信道空闲时间>IFS，立即传输
  2. 信道忙时，延迟到传输结束+IFS
  3. 二进制指数退后：从[0, CWindow]选择随机数
  4. 退后过程中信道忙则挂起，结束后恢复

#### 帧间隙（IFS）优先级控制
- **SIFS**（最高优先级）：用于Ack、CTS、轮询响应
- **PIFS**（中等优先级）：轮询服务
- **DIFS**（最低优先级）：异步数据服务

#### RTS-CTS机制（可选）
- **目的**：通过信道预约避免长帧冲突
- **过程**：发送端发RTS → 接收端回CTS → 数据传输
- **NAV**：网络分配向量，虚拟载波侦听

> RTS-CTS解决隐藏终端问题，但增加了开销，通常只对长帧使用

#### 差错控制
- **检测**：32位CRC校验
- **重传**：停等机制，超时重传
- **分段**：应对无线链路高出错率

> 无线链路出错率比有线高1-2个数量级，必须采用更强的差错控制

### 5.6 QoS增强（EDCA）
- **目标**：为不同应用提供不同优先级
- **队列分类**：
  - AC3：语音（Voice）
  - AC2：视频（Video）
  - AC1：尽力而为（Best effort）
  - AC0：背景流（Background）
- **控制参数**：CWmin、CWmax、AIFS、TXOP

### 5.7 802.11帧格式
- **帧控制**：协议版本、类型、子类型等
- **地址字段**：最多4个地址（DA、SA、BSSID等）
- **主要帧类型**：
  - 管理帧：Beacon、关联请求/响应、认证等
  - 控制帧：RTS、CTS、ACK等
  - 数据帧：普通数据帧、QoS数据帧等

### 5.8 网络管理
#### 关联过程
1. **扫描**：被动扫描（接收Beacon）或主动扫描（发送Probe Request）
2. **认证**：开放系统认证、共享密钥认证、WPA PSK、802.1X EAP
3. **关联**：发送关联请求，接收关联响应

#### 移动性管理
- **漫游**：通过重关联请求切换到新AP
- **睡眠管理**：TIM（流量指示映射）通知睡眠站点有数据

### 5.9 Wi-Fi 6核心技术（802.11ax）
- **OFDMA**：多用户并行传输，提升效率
- **MU-MIMO**：8×8上下行多用户MIMO
- **1024-QAM**：相比256-QAM提升25%速率
- **BSS着色**：同频并发传输优化
- **TWT**：目标唤醒时间，优化功耗管理

> Wi-Fi 6的目标：在高密度环境下将用户平均吞吐量提升4倍，并发用户数提升3倍